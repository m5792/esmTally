<body style="background-color: rgb(1, 1, 1);"></body>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIPL DASHBOARD</title>
  <style>
    :root {
      --card-bg: #ffffff;
      --border: #e5e7eb;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #f7f7f8;
      display: flex;
      justify-content: center;
      align-items: center;
      
    }

    /* Modal container */
    .modalvcr { 
      width: 90in;
      height: 10in;
      background: var(--card-bg); 
      border-radius: 20px; 
      overflow: hidden; 
      border: 1px solid var(--border);
      
      box-shadow: 0 12px 30px rgba(0,0,0,.15);
      display: flex; 
      flex-direction: column;
    }

    /* Header */
    .modalvcr-header { 
      display: flex; 
      flex-direction: column; 
      padding: 16px 18px; 
      border-bottom:1px solid var(--border);
      background-color: #0111c3; 
      flex-shrink: 0;
    }

    .modalvcr-title { font-size: 1.05rem; font-weight:700; color: #b5edeb; }
    .muted { color:#b5edeb; font-weight:bold; }

    /* Navigation */
    nav {
      background-color: #323fcb;
      display: flex;
      justify-content: center;
      border-radius: 8px;
    }

    nav a {
      color: #fff;
      text-decoration: none;
      padding: 8px 14px;
      display: block;
      font-weight: bold;
      transition: background 0.3s;
      cursor: pointer;
      border-radius: 4px;
      margin: 2px;
    }

    nav a:hover { background: #3277cb; }
    nav a.active { background: #65a9f3; }

    /* Body with 20/80 top-bottom split */
    .modalvcr-body {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .top-panel, .bottom-panel {
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }

    .top-panel { flex: 0 0 20%; border-bottom:1px solid var(--border); }
    .bottom-panel { flex: 0 0 80%; }

    .panel-content {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      padding: 16px;
      overflow: auto;
      display: none;
    }

    .panel-content.active { display: block; }

   

    .modalvcr-footer {
      display: flex; 
      justify-content: flex-start; 
      gap: 5px; 
      padding: 12px 16px; 
      border-top: 1px solid var(--border);
      background-color: #2c2c2c;
      flex-shrink: 0;   
    }



    /* Container for table to manage height inside bottom panel */
.bottom-panel .table-container {
    height: 100%;          /* take full bottom panel height */
    overflow: auto;        /* scroll if content exceeds */
    padding: 8px;          /* optional padding */
    box-sizing: border-box;
}

/* Table style */
table {
    width: 100%;           /* auto fit container width */
    max-width: 100%;       /* prevent overflow */
    margin: 0 auto;        /* center table */
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: clamp(10px, 1vw, 14px); /* dynamic text scaling */
    transform: scale(1);   /* scale table to 70% */
    transform-origin: top left; /* scale relative to top-left */
}

/* Adjusted table border & cell style */
th, td {
    border: 1px solid #dcdcdc;
    padding: 8px 10px;
    text-align: left;
   
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}

/* Header design */
th {
    background: linear-gradient(135deg, #070707, #616161);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
}

/* Row styling */
tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* Hover effect */
tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;
}

table tr:hover {
    background-color: #f81404;
    color: rgb(1, 20, 37);
    transition: background-color 0.3s ease, color 0.3s ease;
}

  </style>
</head>
<body>

   <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  modalvcr START  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  <div class="modalvcr">
    <!-- Header -->
    <div class="modalvcr-header">
      <div style="font-weight: bold; color: white; align-items: center;">
        <div class="modalvcr-title">
         <span id="currentDateTime"  style="color:#caddf5;font-size:100%;font-family:Arial;"></span>
    
      
      
      </div>
       
      </div>
      <br/>
      <nav>
        <a class="active" data-target="home">Home</a>
        <a data-target="btn2">Stock Ragister</a>
        <a data-target="btn3">UPCL Calculator</a>
        <a data-target="btn4">ID/Password</a>
        <a data-target="btn5">Admin*</a>
     

           <!-- Dropdown -->
        <select id="navDropdown" style="background-color: #323fcb; color: yellow; border: #323fcb; font-weight: bold;">
          <option value="">More Options</option>
          <option value="https://www.openai.com">OpenAI</option>
          <option  data-target="btn6">Loan Calculator</option>
        </select>

      </nav>
    </div>

    <!-- Body -->
    <div class="modalvcr-body">
      <!-- Top panel -->
      <div class="top-panel">

<!-- home btn top part start -->   
        <div id="home-top" class="panel-content active" style="background-color: rgb(227, 251, 251); color: black;">


<span id="username">Guest</span> <br/><br/>

<span>Serch Invoice by Details</span>
 <input type="text" id="searchInput" placeholder="Search Invoice no., Name,Mobail no, ..." />

<button data-target="vbtn1">Click to New Entry</button>

<button onclick="refreshTable()"  style="background-color:#4d4c4c; color:white; border:none; padding:6px 15px; border-radius:4px; cursor:pointer;"> üîÅ Refresh</button>
 
        </div>
<!-- home btn top part stop --> 

<!-- btn2 -IMPREST LEDGER top part start -->
        <div id="btn2-top" class="panel-content">  </div>
<!-- btn2 -IMPREST LEDGER top part stop -->

<!-- btn3 -upcl calculator top part start -->
        <div id="btn3-top" class="panel-content">
          <label>Enter Your  Units: </label>
  <input type="number" id="units" placeholder="Enter units">
  <button onclick="calculateBill()">Calculate</button>
  <button onclick="resetDefaults()">Reset Defaults</button>
        </div>
<!-- btn3 -upcl calculator top part stop -->

<!-- btn4 - top part START -->
        <div id="btn4-top" class="panel-content"> </div>
 <!-- btn4 - top part stop -->

 <!-- btn5 -top part strat -->
        <div id="btn5-top" class="panel-content">  </div>
<!-- btn5 - top part stop -->


 <!-- btn6 -L top part strat -->
        <div id="btn6-top" class="panel-content"> </div>
<!-- btn6 -top part stop -->


      </div>    <!-- XXXXXXXXXXXXXXX TOP PANAL stop XXXXXXXXXXXXXXXXXXX -->



      <!-- Bottom panel -->
      <div class="bottom-panel">

<!-- home btn bottam part start --> 
        <div id="home-bottom" class="panel-content active">
       
          <div id="recentTransactions"> </div> <br/><br/><br/>

        </div>
<!-- home btn bottam part start --> 

 <!-- btn2 -IMPREST LEDGER bottam part start -->
        <div id="btn2-bottom" class="panel-content"> 
           
          <!-- Data Table -->
<table id="myIVCRTable"></table>

        </div>   
 <!-- btn2 -IMPREST LEDGER bottam part stop -->

 <!-- btn3 -upcl calculator bottam part start -->
        <div id="btn3-bottom" class="panel-content">
 <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:22px; line-height:1.5; color: rgb(7, 7, 7);">
   Uttarakhand Power Corporation Ltd. Energy Charge Calculator
    </span>
<br/>
   <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:16px; line-height:1.5; color: rgb(13, 2, 173);">
     *All Rate & Amt only educational and calculation purpose. 
    </span>
<br/><br/>
           <!-- ===== VALUE KO EDITABLE BANANE KE LYE <td> "contenteditable="true" class="editable"" add kro ===== -->
  <table>
    <tr>
      <th>Description</th>
      <th>Units</th>
      <th>Rate</th>
      <th>Amount</th>
    </tr>
    <tr>
      <td>S1 (0‚Äì98.63)</td>
      <td id="s1u">0</td>
      <td contenteditable="true" class="editable" id="r1">3.65</td>
      <td id="s1c">0</td>
    </tr>
    <tr>
      <td>S2 (98.63‚Äì197.26)</td>
      <td id="s2u">0</td>
      <td contenteditable="true" class="editable" id="r2">5.25</td>
      <td id="s2c">0</td>
    </tr>
    <tr>
      <td>S3 (197.26‚Äì394.52)</td>
      <td id="s3u">0</td>
      <td contenteditable="true" class="editable" id="r3">7.15</td>
      <td id="s3c">0</td>
    </tr>
    <tr>
      <td>S4 (Above 394.52)</td>
      <td id="s4u">0</td>
      <td contenteditable="true" class="editable" id="r4">7.8</td>
      <td id="s4c">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">Total Energy Charge</td>
      <td id="totalEnergy">0</td>
    </tr>
    <tr>
      <td>Fixed Charge (‚Çπ/kW) √ó Load</td>
      
      <td contenteditable="true" class="editable" id="fixedLoad" style="background-color: rgb(248, 202, 202);">3</td>
      <td  id="fixedRate">85</td>
      <td id="fixedAmt">0</td>
    </tr>
    <tr>
      <td>Electricity Duty (/kWh)</td>
      <td id="dutyUnits">0</td>
      <td  id="dutyRate">0.15</td>
      <td id="dutyAmt">0</td>
    </tr>
    <tr>
      <td>Fuel Adjustment (/kWh)</td>
      <td id="fuelUnits">0</td>
      <td  id="fuelRate">0.14</td>
      <td id="fuelAmt">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">TOTAL BILL AMOUNT</td>
      <td id="grandTotal">0</td>
    </tr>
  </table>

   <p style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:14px; line-height:1.5; color: red;">
     *All Rate as per Uttarakhand Power Corporation ltd Monthly Bill August 2025 
    </p>
        </div>
 <!-- btn3 -upcl calculator bottam part stop -->

  <!-- btn4 - bottam part START -->
        <div id="btn4-bottom" class="panel-content"> </div>
 <!-- btn4 - bottam part stop -->

  <!-- btn5 - bottam part start -->
        <div id="btn5-bottom" class="panel-content"> </div>
  <!-- btn5 -bottam part stop -->

   <!-- btn6 - bottam part start -->
        <div id="btn6-bottom" class="panel-content">
        
          
 <!-- ...................................Loan Calculator code strat .........................................................................-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }
    .box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: auto;
    }
    h2 { margin-top: 0; }
    label { display: block; margin: 8px 0 4px; }
    input {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .summary {
      margin-top: 20px;
      background: #f0f4ff;
      padding: 10px;
      border-radius: 8px;
    }
    .summary b { color: #222; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Loan Calculator</h2>

    <label>Loan Amount (‚Çπ):</label>
    <input type="number" id="loan" onblur="calculateLoan()">

    <label>Rate of Interest (% p.a.):</label>
    <input type="number" step="0.01" id="rate" onblur="calculateLoan()">

    <label>EMI (‚Çπ):</label>
    <input type="number" id="emi" onblur="calculateLoan()">

    <label>Tenure (Months):</label>
    <input type="number" id="months" onblur="calculateLoan()">

    <label>Installment Start Date:</label>
    <input type="date" id="startDate">

    <div class="summary" id="summary">
      <h3>üìå Loan Summary</h3>
      <p><b>Loan Amount:</b> ‚Çπ<span id="sLoan">-</span></p>
      <p><b>Rate of Interest:</b> <span id="sRate">-</span> % p.a.</p>
      <p><b>EMI:</b> ‚Çπ<span id="sEmi">-</span></p>
      <p><b>Tenure:</b> <span id="sMonths">-</span> months</p>
      <p><b>Start Date:</b> <span id="sDate">-</span></p>
    </div>
  </div>

  <script>
    function calculateLoan() {
      let P = parseFloat(document.getElementById("loan").value);   // Loan Amount
      let R = parseFloat(document.getElementById("rate").value);   // Annual Interest %
      let EMI = parseFloat(document.getElementById("emi").value);  // EMI
      let N = parseFloat(document.getElementById("months").value); // Tenure in Months

      let r = (R/100)/12; // monthly rate

      // 1Ô∏è‚É£ EMI ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      if (!EMI && P && R && N) {
        EMI = (P * r * Math.pow(1+r, N)) / (Math.pow(1+r, N) - 1);
        document.getElementById("emi").value = EMI.toFixed(2);
      }

      // 2Ô∏è‚É£ Tenure ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      else if (!N && P && R && EMI) {
        N = Math.log(EMI / (EMI - P*r)) / Math.log(1+r);
        document.getElementById("months").value = Math.round(N);
      }

      // 3Ô∏è‚É£ Loan Amount ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      else if (!P && EMI && R && N) {
        P = (EMI * (Math.pow(1+r, N) - 1)) / (r * Math.pow(1+r, N));
        document.getElementById("loan").value = P.toFixed(2);
      }

      // 4Ô∏è‚É£ Rate ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç (iterative method)
      else if (!R && P && EMI && N) {
        let guess = 0.01;
        let maxIter = 1000;
        for (let i = 0; i < maxIter; i++) {
          let emiCalc = (P * guess * Math.pow(1+guess, N)) / (Math.pow(1+guess, N) - 1);
          if (Math.abs(emiCalc - EMI) < 0.1) break;
          if (emiCalc > EMI) guess -= 0.0001;
          else guess += 0.0001;
        }
        R = guess * 12 * 100;
        document.getElementById("rate").value = R.toFixed(2);
      }

      // Summary update
      document.getElementById("sLoan").innerText = P ? P.toFixed(2) : "-";
      document.getElementById("sRate").innerText = R ? R.toFixed(2) : "-";
      document.getElementById("sEmi").innerText = EMI ? EMI.toFixed(2) : "-";
      document.getElementById("sMonths").innerText = N ? N : "-";
      
      let d = document.getElementById("startDate").value;
      document.getElementById("sDate").innerText = d ? d : "-";
    }
  </script>
</body>
</html>

 <!-- ...................................Loan Calculator code stop .........................................................................-->



        </div>
  <!-- btn6 - bottam part stop -->


      </div>    <!-- XXXXXXXXXXXXXXXXXXXXXXXX  BOTTAM PANAL stop  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -->
    </div>    <!-- XXXXXXXXXXXXXXXXXXXXXXXX  MODALBODY STOP XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -->

    <!-- Footer START -->
    <div class="modalvcr-footer">
      <div>

  
        <div class="modalvcr-title">eS|MTally</div>
        <div class="muted"> <span>User Name:</span> <span id="username">Guest</span>  <span>User ID:</span> <span id="userid"></span> <span id="authorization" style="color: #2c2c2c;"></span></div> 
      </div>
    </div>    <!-- Footer STOP -->
  </div>    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  modalvcr stop  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

 
 

  <script>
  const navLinks = document.querySelectorAll('nav a');
  const dropdown = document.getElementById('navDropdown');
  const authSpan = document.getElementById('authorization');

  // Helper function: check if authorized
  function isAuthorized(target) {
    const authText = (authSpan.textContent || "").trim();
    if (!authText) return false;
    const allowedList = authText.split(',').map(v => v.trim());
    // e.g. data-target="btn2" ‚Üí extract numeric part '2'
    const num = target.replace(/\D+/g, ''); 
    return allowedList.includes(num);
  }

  // Function to show "Not authorized" alert
  function showNotAuthorized() {
    alert("‚ùå You are not authorized for this menu");
  }

  // Navigation links click handler
  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      const target = link.dataset.target;

      // If link has numeric target and not authorized ‚Üí block
      if (target && target.startsWith('btn') && !isAuthorized(target)) {
        showNotAuthorized();
        return;
      }

      // Update active link
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');

      // Update top panels
      document.querySelectorAll('.top-panel .panel-content').forEach(p => p.classList.remove('active'));
      const top = document.getElementById(`${target}-top`);
      if (top) top.classList.add('active');

      // Update bottom panels
      document.querySelectorAll('.bottom-panel .panel-content').forEach(p => p.classList.remove('active'));
      const bottom = document.getElementById(`${target}-bottom`);
      if (bottom) bottom.classList.add('active');
    });
  });

  // Dropdown handler
  dropdown.addEventListener('change', () => {
    const val = dropdown.value;
    const target = dropdown.options[dropdown.selectedIndex].getAttribute("data-target");

    if (val) {
      if (target) {
        // Authorization check for dropdown internal targets
        if (target && target.startsWith('btn') && !isAuthorized(target)) {
          showNotAuthorized();
          dropdown.selectedIndex = 0;
          return;
        }

        // same-page navigation (trigger like nav link)
        navLinks.forEach(l => l.classList.remove('active'));
        const navLink = document.querySelector(`nav a[data-target="${target}"]`);
        if (navLink) navLink.classList.add('active');

        // Panels update
        document.querySelectorAll('.top-panel .panel-content').forEach(p => p.classList.remove('active'));
        const top = document.getElementById(`${target}-top`);
        if (top) top.classList.add('active');

        document.querySelectorAll('.bottom-panel .panel-content').forEach(p => p.classList.remove('active'));
        const bottom = document.getElementById(`${target}-bottom`);
        if (bottom) bottom.classList.add('active');
      } else {
        // External link ‚Üí open in new tab
        window.open(val, "_blank");
      }
    }

    dropdown.selectedIndex = 0; // reset to "More Options"
  });
</script>

</body>
</html>

<!-- ------------------  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -------------------------------------- -->



 <!-- login code and script start hare ........................................................... -->


 <!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sheet Login Example</title>
  <style>
    /* Simple modal styling */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
    }
    .modal {
      background: #fff; padding:20px; border-radius:8px;
      width: 320px; box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
    }
    .modal h2 { margin:0 0 10px; font-size:18px; }
    .modal label { display:block; margin:8px 0 4px; font-weight:600; }
    .modal input[type="text"], .modal input[type="password"] {
      width:100%; padding:8px; box-sizing:border-box; border:1px solid #ccc; border-radius:4px;
    }
    .modal .actions { margin-top:12px; display:flex; gap:8px; justify-content:flex-end; }
    button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
    button.primary { background:#2563eb; color:white; }
    button.normal { background:#f59595; }
    .error { color:#b91c1c; margin-top:8px; font-size:13px; }
    /* Page content spacing */
    .content { padding:20px; }
  </style>
</head>
<body>


  <!-- Login modal (hidden once logged in) -->
  <div id="loginOverlay" class="overlay" aria-hidden="false">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <h2 id="loginTitle">Login karein</h2>

      <label for="inputUserId">User ID</label>
      <input id="inputUserId" type="text" autocomplete="username" />

      <label for="inputPassword">Password</label>
      <input id="inputPassword" type="password" autocomplete="current-password" />

      <div class="actions">
        <button id="btnCancel" class="normal" type="button">Cancel</button>
        <button id="btnLogin" class="primary" type="button">Login</button>
      </div>

      <div id="loginError" class="error" style="display:none;"></div>
    </div>
  </div>

 <script>
  // -------------------------
  // CONFIG - user provided
  // -------------------------
  const userApiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const userSheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const userRange = "USER!A:N"; // full range as requested

  // -------------------------
  // Helper & DOM refs
  // -------------------------
  const overlay = document.getElementById('loginOverlay');
  const btnLogin = document.getElementById('btnLogin');
  const btnCancel = document.getElementById('btnCancel');
  const inputUserId = document.getElementById('inputUserId');
  const inputPassword = document.getElementById('inputPassword');
  const loginError = document.getElementById('loginError');

  // ‚úÖ Updated: Select all spans (not just the first)
  const allUserIdSpans = document.querySelectorAll('#userid');
  const allUserNameSpans = document.querySelectorAll('#username');
  const allAuthorizationSpans = document.querySelectorAll('#authorization');

  // Store fetched sheet rows (array of arrays)
  let sheetRows = null;

  // -------------------------
  // Fetch sheet data
  // -------------------------
  async function fetchSheetData() {
    try {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${encodeURIComponent(userSheetId)}/values/${encodeURIComponent(userRange)}?key=${encodeURIComponent(userApiKey)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Sheet fetch failed: " + res.statusText);
      const data = await res.json();
      sheetRows = data.values || [];
    } catch (err) {
      console.error(err);
      loginError.style.display = 'block';
      loginError.textContent = "Sheet se data laane me problem: " + (err.message || err);
    }
  }

  fetchSheetData();

  // -------------------------
  // Login logic
  // -------------------------
  function tryLogin() {
    loginError.style.display = 'none';
    const enteredId = inputUserId.value.trim();
    const enteredPwd = inputPassword.value;

    if (!enteredId || !enteredPwd) {
      loginError.style.display = 'block';
      loginError.textContent = "Donon fields bharna zaroori hai.";
      return;
    }

    if (!sheetRows) {
      loginError.style.display = 'block';
      loginError.textContent = "Sheet data abhi tak loaded nahi hua. Thodi der me try karein.";
      return;
    }

    // find matching row
    let matchedRow = null;
    for (let r = 0; r < sheetRows.length; r++) {
      const row = sheetRows[r];
      const colB = (row[1] || "").toString().trim();
      const colC = (row[2] || "").toString();
      if (colB === enteredId && colC === enteredPwd) {
        matchedRow = row;
        break;
      }
    }

    if (!matchedRow) {
      loginError.style.display = 'block';
      loginError.textContent = "User ID ya Password galat hai. Dobara koshish karein.";
      return;
    }

    // ‚úÖ Update all spans across entire page
    const userNameValue = (matchedRow[4] || "").toString();
    const authValue = (matchedRow[5] || "").toString().trim() || "Not authorized any function";

    allUserIdSpans.forEach(span => span.textContent = enteredId);
    allUserNameSpans.forEach(span => span.textContent = userNameValue);
    allAuthorizationSpans.forEach(span => span.textContent = authValue);

    // hide modal
    overlay.style.display = 'none';
  }

  // Cancel button
  btnCancel.addEventListener('click', () => {
    inputUserId.value = "";
    inputPassword.value = "";
  });

  // Login click
  btnLogin.addEventListener('click', tryLogin);

  // Enter key shortcuts
  inputPassword.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') tryLogin();
  });
  inputUserId.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') inputPassword.focus();
  });

  // Focus first field
  inputUserId.focus();
</script>

</body>
</html>


 <!-- login code and script start hare ........................................................... -->







<!-- ------------------  upcl bill calculator start -------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Charge Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f6f9; }
    h2 { color:#333; }
    
    input { padding:5px; width:200px; }
    .total { font-weight:bold; background:#e6f7ff; }
    .editable { background:#fff8dc; }
  </style>
</head>
<body>

<script>
  // Default Values
  const defaults = {
    r1: 3.65,
    r2: 5.25,
    r3: 7.15,
    r4: 7.80,
    fixedRate: 85,
    fixedLoad: 3,
    dutyRate: 0.15,
    fuelRate: 0.14
  };

  // Reset function
  function resetDefaults() {
    for (let key in defaults) {
      document.getElementById(key).innerText = defaults[key];
    }
    document.getElementById("units").value = "";
    document.querySelectorAll("td[id$='u'], td[id$='c'], #totalEnergy, #grandTotal, #fixedAmt, #dutyAmt, #fuelAmt, #dutyUnits, #fuelUnits")
      .forEach(el => el.innerText = "0");
    document.getElementById("fixedLoad").innerText = defaults.fixedLoad;
  }

  // Calculation
  function calculateBill() {
    let units = parseFloat(document.getElementById("units").value) || 0;

    let rate1 = parseFloat(document.getElementById("r1").innerText) || defaults.r1;
    let rate2 = parseFloat(document.getElementById("r2").innerText) || defaults.r2;
    let rate3 = parseFloat(document.getElementById("r3").innerText) || defaults.r3;
    let rate4 = parseFloat(document.getElementById("r4").innerText) || defaults.r4;

    let fixedRate = parseFloat(document.getElementById("fixedRate").innerText) || defaults.fixedRate;
    let fixedLoad = parseFloat(document.getElementById("fixedLoad").innerText) || defaults.fixedLoad;
    let dutyRate = parseFloat(document.getElementById("dutyRate").innerText) || defaults.dutyRate;
    let fuelRate = parseFloat(document.getElementById("fuelRate").innerText) || defaults.fuelRate;

    // Slabs
    let s1 = Math.min(units, 98.63);
    let s2 = (units > 98.63) ? Math.min(units - 98.63, 98.63) : 0;
    let s3 = (units > 197.26) ? Math.min(units - 197.26, 197.26) : 0;
    let s4 = (units > 394.52) ? (units - 394.52) : 0;

    let c1 = s1 * rate1;
    let c2 = s2 * rate2;
    let c3 = s3 * rate3;
    let c4 = s4 * rate4;

    let totalEnergy = c1 + c2 + c3 + c4;
    let fixed = fixedRate * fixedLoad;
    let duty = units * dutyRate;
    let fuel = units * fuelRate;
    let grandTotal = totalEnergy + fixed + duty + fuel;

    // Update table
    document.getElementById("s1u").innerText = s1.toFixed(2);
    document.getElementById("s2u").innerText = s2.toFixed(2);
    document.getElementById("s3u").innerText = s3.toFixed(2);
    document.getElementById("s4u").innerText = s4.toFixed(2);

    document.getElementById("s1c").innerText = c1.toFixed(2);
    document.getElementById("s2c").innerText = c2.toFixed(2);
    document.getElementById("s3c").innerText = c3.toFixed(2);
    document.getElementById("s4c").innerText = c4.toFixed(2);

    document.getElementById("totalEnergy").innerText = totalEnergy.toFixed(2);

    document.getElementById("fixedAmt").innerText = fixed.toFixed(2);
    document.getElementById("dutyUnits").innerText = units.toFixed(2);
    document.getElementById("dutyAmt").innerText = duty.toFixed(2);
    document.getElementById("fuelUnits").innerText = units.toFixed(2);
    document.getElementById("fuelAmt").innerText = fuel.toFixed(2);

    document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
  }

  // Use DOMContentLoaded instead of window.onload
  document.addEventListener("DOMContentLoaded", resetDefaults);
</script>


</body>
</html>
<!-- ------------------  upcl bill calculator stop -------------------------------------- -->


<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, M1000 - ID/PASWORD OTHER DETAILS Start Heare -->

 <!DOCTYPE html>
 <html>
 <head>
     <title>ID | PASSWORD ESS</title>
     <style>
         body {
             margin: 0;
             font-family: Arial, sans-serif;
         }
         #searchDiv {
             position: sticky;
             top: 0;
             background: #f8f9fa;
             padding: 10px;
             border-bottom: 2px solid #ccc;
             z-index: 1000; /* Ensure it stays above the table */
         }
         
         tr.hidden {
             display: none;
         }
         #noResultsMessage {
             text-align: center;
             margin-top: 10px;
         }
 
        
         /* ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, Highlight the search value colour in table */
         .highlight {
     background-color: rgb(21, 215, 241);
     font-weight: bold;
 }
     </style>
     <script>
        async function M1000() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
            const sheetId = "1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw";
            const range = 'PASSWORD!A:E';

            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();

                if (data.values) {
                    const table = document.getElementById('m1000lTable');
                    table.innerHTML = ''; // Clear existing table content

                    data.values.forEach((row, index) => {
                        const tr = document.createElement('tr');

                        if (index === 0) {
                            // Header row
                            row.forEach((cell) => {
                                const th = document.createElement('th');
                                th.textContent = cell;
                                tr.appendChild(th);
                            });
                        } else {
                            // Data rows
                            row.forEach((cell, cellIndex) => {
                                const td = document.createElement('td');

                                // Check if the cell contains a URL and create a clickable link
                                if (typeof cell === 'string' && (cell.startsWith('http') || cell.startsWith('www'))) {
                                    const a = document.createElement('a');
                                    a.href = cell.startsWith('http') ? cell : `http://${cell}`; // Add http:// if missing
                                    a.innerHTML = "&#128221; Click to View PO"; // Use icon as link text
                                    a.target = "_blank";
                                    td.appendChild(a);
                                } else {
                                    td.textContent = cell;
                                }

                                // Highlight row based on column value
                                if (cellIndex === 0) {
                                    if (cell.toLowerCase() === "credit note") {
                                        tr.classList.add('blue');
                                    } else if (cell.toLowerCase() === "bank") {
                                        tr.classList.add('red');
                                    }
                                }

                                tr.appendChild(td);
                            });
                        }
                        table.appendChild(tr);
                    });
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }

        function serchProfile() {
            const query = document.getElementById('inputArea').value.toLowerCase();
            const table = document.getElementById('m1000lTable');
            const rows = document.querySelectorAll('#m1000lTable tr');
            let visibleRows = 0; // Track the number of visible rows

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row

                // Remove previous highlights
                row.querySelectorAll('td').forEach(cell => {
                    cell.innerHTML = cell.textContent; // Reset any highlights
                });

                if (query.trim() === '') {
                    row.classList.add('hidden'); // Hide all rows if search bar is blank
                } else {
                    const cells = row.querySelectorAll('td');
                    const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');

                    if (rowText.includes(query)) {
                        row.classList.remove('hidden');
                        visibleRows++;

                        // Highlight the search term within the row
                        cells.forEach(cell => {
                            const cellText = cell.textContent;
                            const regex = new RegExp(`(${query})`, 'gi');
                            const highlightedText = cellText.replace(regex, '<span class="highlight">$1</span>');
                            cell.innerHTML = highlightedText; // Apply highlighting
                        });
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });

            // Show the table if there are visible rows
            if (visibleRows > 0) {
                table.style.display = 'table';
            } else {
                table.style.display = 'none';
            }

            // Display a message if no rows are visible
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }

        window.onload = () => {
            // Hide table initially
           document.getElementById('m1000lTable').style.display = 'none';

            // Load data and set up search
              M1000();
           document.getElementById('inputArea').addEventListener('input', serchProfile);
           };
    </script>
 </head>
 <body>
     

    
 </body>
 </html>
 <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, M1000 - ID/PASWORD OTHER DETAILS stop Heare -->









<!-- Current date and time will be displayed here -->
                    
<meta name="viewport" content="width=device-width, initial-scale=1.0">

            
<script>
    function displayCurrentDateTime() {
        const now = new Date();
        
        // Formatting options
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit' 
        };
        
        // Formatting date and time
        const formattedDateTime = now.toLocaleString('en-US', options);
        
        // Displaying in the div
        document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
    }

    // Call the function on page load to show the current date and time
    displayCurrentDateTime();
    
    // Update the date and time every second
    setInterval(displayCurrentDateTime, 1000);
</script>
 <!-- Current date and time will be displayed Stop -->






























































 <!-- IMPREST LEDGER code and script start hare ........................................................... -->
 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IVCR Sheet Viewer (User Filtered)</title>
<style>

  label {
    font-size: 18px;
    color: #013aac;
    margin-right: 8px;
  }
  input[type="text"] {
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 260px;
  }
  button {
    background: #013aac;
    color: white;
    border: none;
    padding: 7px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover {
    background: #011f66;
  }
  tr.receipt {
    color: #cc0909;
  }
  tr.bill {
    background-color: #ffe7e7;
  }
</style>



<style>
.dropdown-container {
  position: relative;
  width: 250px;
  margin-bottom: 20px;
}

.dropdownCSSlist {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  max-height: 180px;
  overflow-y: auto;
  list-style: none;
  padding: 0;
  margin: 4px 0 0;
  display: none;
  z-index: 1000;
}

.dropdownCSSlist li:hover {
  background-color: #f0f0f0;
}
</style>


</head>
<body>




<script>
  const ivcrKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const ivcrSheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
  const ivcrRange = 'IVCR!W:AD';
  let fulivcrData = [];

  // üìÑ Load IVCR Sheet from Google Sheets
  async function loadIVCRSheet() {
    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${ivcrSheetId}/values/${ivcrRange}?key=${ivcrKey}`
      );
      const data = await response.json();
      if (data.values) fulivcrData = data.values;

      renderTableForCurrentUser();
      populateDropdownList(fulivcrData); // ‚úÖ FIX: Populate dropdown after data loads
    } catch (err) {
      console.error("Error fetching IVCR data:", err);
    }
  }

  // üßæ Filter data based on <span id="userid">
  function renderTableForCurrentUser() {
    const currentUser = document.getElementById('userid').textContent.trim().toLowerCase();
    if (!currentUser || currentUser === "not logged in") return;

    const filtered = fulivcrData.filter(
      (row, i) => i === 0 || (row[1] || '').trim().toLowerCase() === currentUser
    );

    populateIVCRTable(filtered);
  }

  // ü™Ñ Populate Table
  function populateIVCRTable(data) {
    const table = document.getElementById("myIVCRTable");
    table.innerHTML = '';

    data.forEach((row, index) => {
      const tr = document.createElement("tr");

      if (index === 0) {
        row.forEach(cell => {
          const th = document.createElement("th");
          th.textContent = cell;
          tr.appendChild(th);
        });
        const th = document.createElement("th");
        th.textContent = "Balance";
        tr.appendChild(th);
      } else {
        row.forEach((cell, idx) => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);

          if (idx === 2) {
            const type = cell.trim().toLowerCase();
            if (type === 'receipt') tr.classList.add('receipt');
            if (type === 'bill') tr.classList.add('bill');
          }
        });
        const td = document.createElement("td");
        td.className = "runningBalance";
        tr.appendChild(td);
      }
      table.appendChild(tr);
    });

    calculateIVCRRunningBalance();
  }

  // üí∞ Calculate Running Balance
  function calculateIVCRRunningBalance() {
    const rows = Array.from(document.querySelectorAll("#myIVCRTable tr")).slice(1);
    if (rows.length === 0) return;
    let balance = 0;

    for (let i = rows.length - 1; i >= 0; i--) {
      const row = rows[i];
      const tds = row.querySelectorAll('td');
      const amt = parseFloat(tds[5]?.textContent || "0");
      const typ = tds[2]?.textContent.trim().toLowerCase();

      if (!isNaN(amt)) {
        if (typ === 'receipt' || typ === 'salary') balance += amt;
        else if (typ === 'payment' || typ === 'bill') balance -= amt;
      }
      tds[tds.length - 1].textContent = balance.toFixed();
    }
  }

  // üîÑ Refresh Function
  async function refreshIVCRTable() {
    await loadIVCRSheet();
  }

  // üîç Global Search
  function filterIVCRTableGlobally() {
    const input = document.getElementById("ivcrGlobalSearch").value.toLowerCase();
    const table = document.getElementById("myIVCRTable");
    const rows = table.querySelectorAll("tr");

    rows.forEach((row, index) => {
      if (index === 0) return;
      const match = Array.from(row.querySelectorAll("td")).some(td =>
        td.textContent.toLowerCase().includes(input)
      );
      row.style.display = match ? "" : "none";
    });
  }

  // ‚úÖ FIX: DROPDOWN FUNCTIONS
  function populateDropdownList(data) {
    const ul = document.getElementById("dropdownIVCRList");
    ul.innerHTML = '';
    const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))].filter(v => v);

    uniqueValues.forEach(value => {
      const li = document.createElement("li");
      li.textContent = value;
      li.style.padding = "6px 10px";
      li.style.cursor = "pointer";
      li.style.borderBottom = "1px solid #ddd";

      li.onclick = () => {
        document.getElementById('dropdownIVCRSearch').value = value;
        ul.style.display = "none";
        filterTableByLedger(value);
      };

      ul.appendChild(li);
    });
  }

  function filterIVCRDropdown() {
    const searchInput = document.getElementById("dropdownIVCRSearch");
    const list = document.getElementById("dropdownIVCRList");
    const searchVal = searchInput.value.toLowerCase();

    const items = list.querySelectorAll("li");
    let found = false;

    items.forEach(item => {
      const match = item.textContent.toLowerCase().includes(searchVal);
      item.style.display = match ? "block" : "none";
      if (match) found = true;
    });

    list.style.display = found && searchVal !== "" ? "block" : "none";
  }

  // ‚úÖ FIX: Filter table by ledger name
  function filterTableByLedger(ledgerName) {
    const rows = document.querySelectorAll("#myIVCRTable tr");
    rows.forEach((row, index) => {
      if (index === 0) return;
      const ledgerCell = row.querySelectorAll("td")[4];
      row.style.display = ledgerCell && ledgerCell.textContent === ledgerName ? "" : "none";
    });
  }

  // üñ® Print Function
  function printIVCRTable() {
    const table = document.getElementById("myIVCRTable").outerHTML;
    const today = new Date().toLocaleString();
    const user = document.getElementById('userid').textContent.trim();

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html>
        <head>
          <title>${user} - Account Statement</title>
          <style>
            body { font-family: 'Segoe UI', sans-serif; margin: 20px; color: #000; }
            h2 { text-align: center; text-transform: uppercase; }
            .subtitle { text-align: center; font-size: 14px; color: #555; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; font-size: 13px; }
            th, td { border: 1px solid #333; padding: 6px 8px; text-align: left; }
            th { background: #f0f0f0; font-weight: bold; }
            tr:nth-child(even) { background-color: #fafafa; }
            .footer { margin-top: 30px; font-size: 12px; text-align: center; color: #555; }
            @media print { button { display: none; } }
          </style>
        </head>
        <body>
          <h2>${user} - Account Statement</h2>
          <div class="subtitle">Printed on: ${today}</div>
          ${table}
          <div class="footer">System-generated statement. No signature required.</div>
          <script>window.print();<\/script>
        </body>
      </html>
    `);
    printWindow.document.close();
  }

  // ‚ö° DOM Load + Watch for Login
  document.addEventListener("DOMContentLoaded", () => {
    const userSpan = document.getElementById('userid');
    const observer = new MutationObserver(() => {
      const value = userSpan.textContent.trim();
      if (value && value !== "Not logged in") {
        observer.disconnect();
        loadIVCRSheet();
      }
    });
    observer.observe(userSpan, { childList: true });
  });
</script>





</body>
</html>
 <!-- IMPREST LEDGER code and script STOP hare ........................................................... -->








 











 <!-- IVCR form div script start hare -->
<!-- ‚úÖ IVCR Form Script (Full Fixed Version) -->
<script>
  const scriptIVCRURL = 'https://script.google.com/macros/s/AKfycbz-lyd06EKKSO4xVaTSRWoIgMWS0C9nZvzipEP59K25TZSOSdL5CMpYJNPgmF1nyyGrXg/exec';

  // üîπ Handle form submission
  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVCRForm") return;

    e.preventDefault();

    const formMode = document.getElementById("formModeIVCR").value;
    const submitIVCRButton = document.getElementById("submitIVCRButton");
    submitIVCRButton.disabled = true;
    submitIVCRButton.value = "Wait...";

    // üîπ Add timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value =
      `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    // üîπ Convert text to uppercase
    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    // üîπ Choose submit or modify
    if (formMode === "modify") {
      await modifyIVCREntry();
    } else {
      await submitIVCREntry(form);
    }

    submitIVCRButton.disabled = false;
    submitIVCRButton.value = "Submit";
  });

  // üîπ Submit new entry
  async function submitIVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();

        // ‚úÖ Reset form state
        document.getElementById("formModeIVCR").value = "new";
        document.getElementById("sNo").value = "";

        // ‚úÖ Refresh sheet & table
        await loadIVCRSheet();
 

        // ‚úÖ Remove DLT option
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) voucherDropdown.removeChild(dltOption);

      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  // üîπ Fetch details by S.No for modify/delete
  async function fetchIVCRDetails() {
    const sNo = document.getElementById("searchIVCRSNo").value;
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
      const data = await response.json();

      const voucherTypeDropdown = document.getElementById("voucherType");
      const selectedIVVoucher = voucherTypeDropdown.value;

      if (data.result !== "error" && data.Voucher === selectedIVVoucher) {

        // ‚úÖ Fill fetched data
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("voucherType").value = data.Voucher;
        document.getElementById("ivcr0").value = data.Type;
        document.getElementById("ivcr1").value = data.Date;
        document.getElementById("dropdownIVCRSearch").value = data.Ledger;
        document.getElementById("ivcr2").value = data.Amount;
        document.getElementById("ivcr3").value = data.Narration;

        // ‚úÖ Add DLT option if missing
        if (![...voucherTypeDropdown.options].some(opt => opt.value === "DLT")) {
          const deleteOption = document.createElement("option");
          deleteOption.value = "DLT";
          deleteOption.text = "Delete";
          deleteOption.style.color = "red";
          deleteOption.style.backgroundColor = "blue";
          voucherTypeDropdown.appendChild(deleteOption);
        }

        // ‚úÖ Set modify mode
        document.getElementById("formModeIVCR").value = "modify";
        alert("Select 'Delete' Option in User Section to Delete Entry or Modify Details.");
      } else {
        alert("No record found for the given S.No.");
      }

    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  // üîπ Modify existing entry
  async function modifyIVCREntry() {
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";

    const form = document.getElementById('mainIVCRForm');

    // ‚úÖ New timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value =
      `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();

        // ‚úÖ Reset state for new entry
        document.getElementById("sNo").value = "";
        document.getElementById("formModeIVCR").value = "new";
        document.getElementById("submitIVCRButton").value = "Submit";
        document.getElementById("submitIVCRButton").disabled = false;

        // ‚úÖ Reload & refresh
        await loadIVCRSheet();
     

        // ‚úÖ Remove DLT option
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) voucherDropdown.removeChild(dltOption);

      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  // üîπ Optional reset function (can be reused)
  function resetIVCRState() {
    document.getElementById("formModeIVCR").value = "new";
    document.getElementById("sNo").value = "";
  }
</script>
<!-- ‚úÖ End of IVCR Form Script -->
<!-- IVCR form div script stop hare -->















<!-- ---------------------------------------------------- GC SALE CREAT ENTRY SCRIPT STOP --------------------------------------------------------------------------------- -->
<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzy9pby7TR46ZszsxsnM1XXyCxOThIdQoY1pN9DK9nBPZHLEq9sfZrnWyauCK9Q31MMYA/exec';

  document.addEventListener('DOMContentLoaded', () => {

    // ---------- SAVE NEW ENTRY ----------
    document.getElementById('mainForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      // Add timestamp
      const now = new Date();
      const formattedTimestamp = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
      document.getElementById('timestamp').value = formattedTimestamp;

      // Convert text inputs to uppercase
      const formInputs = this.querySelectorAll('input, textarea');
      formInputs.forEach(input => {
        if (input.type === 'text' || input.tagName === 'TEXTAREA') {
          input.value = input.value.toUpperCase();
        }
      });

      // ‚úÖ Required fields check before save
      if (!checkRequired(this)) return;

      const formData = new FormData(this);

      try {
        const response = await fetch(scriptURL, { method: 'POST', body: formData });
        let resultText = await response.text();

        let result;
        try {
          result = JSON.parse(resultText);
        } catch {
          result = { result: resultText.includes('success') ? 'success' : 'error', error: resultText };
        }

        if (result.result === 'success') {
          alert('‚úÖ Entry saved successfully!');
          this.reset(); // Reset form only
          refreshTable();
          document.getElementById('submitButton').style.display = 'block';
          document.getElementById('modifyButton').style.display = 'none';
        } else {
          alert(`‚ö†Ô∏è Error: ${result.error || resultText}`);
        }

      } catch (error) {
        console.error('Error submitting form:', error);
        alert('An error occurred while submitting. Please try again.');
      }
    });

  });

  // ---------- FETCH DATA ----------
  async function fetchData() {
    const sNo = document.getElementById('sNo').value;
    if (!sNo) {
      alert('Please enter a valid SNo.');
      return;
    }

    const waitMessage = document.getElementById('waitMessage');
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptURL}?sNo=${sNo}`);
      const result = await response.json();

      if (result.result === 'error') {
        alert(result.error);
        return;
      }

      // Populate fields
      document.getElementById('fy').value = result.fy || '';
      document.getElementById('ivn').value = result.ivn || '';
      document.getElementById('mobileNo').value = result.mobileNo || '';
      document.getElementById('customerName').value = result.customerName || '';
      document.getElementById('address').value = result.address || '';
      document.getElementById('date').value = result.date || '';
      document.getElementById('itemName').value = result.itemName || '';
      document.getElementById('description').value = result.description || '';
      document.getElementById('hsn').value = result.hsn || '';
      document.getElementById('qty').value = result.qty || '';
      document.getElementById('unit').value = result.unit || '';
      document.getElementById('saleType').value = result.saleType || '';
      document.getElementById('gst').value = result.gst || '';
      document.getElementById('totalAmt').value = result.totalAmt || '';
      document.getElementById('gst-option').value = result.gstOption || '';
      document.getElementById('dynamic-input').value = result.gstin || '';

      document.getElementById('modifyButton').style.display = 'block';
      document.getElementById('submitButton').style.display = 'none';
    } catch (error) {
      console.error('Error fetching data:', error);
      alert('An error occurred while fetching data. Please try again.');
    }

    setTimeout(() => {
      waitMessage.style.display = 'none';
    }, 2000);
  }

  // ---------- MODIFY ENTRY ----------
  async function modifyEntry() {
    const form = document.getElementById('mainForm');

    // ‚úÖ Required field validation before modify
    if (!checkRequired(form)) return;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    const waitMessage = document.getElementById('waitMessage');
    waitMessage.innerText = "Saving data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(scriptURL, { method: 'POST', body: formData });
      const result = await response.json();

      setTimeout(() => {
        waitMessage.style.display = 'none';
        if (result.result === 'success') {
          alert('‚úÖ Entry modified successfully!');
          form.reset(); // only reset form, no reload
          refreshTable();
          document.getElementById('submitButton').style.display = 'block';
          document.getElementById('modifyButton').style.display = 'none';
        } else {
          alert(`‚ö†Ô∏è Error modifying entry: ${result.error}`);
        }
      }, 3000);
    } catch (error) {
      console.error('Error modifying entry:', error);
      alert('An error occurred while saving changes.');
      waitMessage.style.display = 'none';
    }
  }

  // ---------- COMMON REQUIRED FIELD CHECK ----------
  function checkRequired(form) {
    const requiredFields = form.querySelectorAll('[required]');
    let allFilled = true;

    requiredFields.forEach(field => {
      if (!field.value.trim()) {
        field.style.border = '2px solid red';
        allFilled = false;
      } else {
        field.style.border = '';
      }
    });

    if (!allFilled) {
      alert('‚ö†Ô∏è Please fill all required fields.');
      return false;
    }

    return true;
  }
</script>












<!-- üìå POPUP STRUCTURE -->
<div id="invoicePopup" 
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:#fff; padding:20px; width:80%; max-height:90%; overflow:auto; border-radius:10px; position:relative;">
    <button onclick="closePopup()" 
            style="position:absolute; top:8px; right:12px; background:red; color:white; border:none; padding:4px 10px; border-radius:4px; cursor:pointer;">X</button>
    <div id="invoice-view"></div>
    <button onclick="printInvoice()" 
            style="margin-top:15px; background:green; color:white; border:none; padding:8px 16px; border-radius:5px; cursor:pointer;">üñ® Print Invoice</button>
  </div>
</div>

<script>
  let gcdata = []; // All fetched data

  async function gcdataLoad() { 
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1ca80E9lsBoctklZMKdNIAGRCbcEUDqNX775P1H8jbeM";
    const range = 'FORM!A:S';
    const recentTransactionsDiv = document.getElementById("recentTransactions");

    try {
      recentTransactionsDiv.innerHTML = "";

      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
      );
      const data = await response.json();

      if (data && data.values && data.values.length > 1) {
        gcdata = data.values.slice(1); // remove headers
        renderTable(getLastTen(gcdata)); // show last 10 initially
      } else {
        recentTransactionsDiv.innerHTML = "<p>No data found in the specified range.</p>";
      }
    } catch (error) {
      recentTransactionsDiv.innerHTML = "<p>Error loading data.</p>";
      console.error("Error fetching data from Google Sheets:", error);
    }
  }

  // üîÅ Refresh button function
  function refreshTable() {
    document.getElementById("recentTransactions").innerHTML = "<p>Refreshing data...</p>";
    gcdataLoad(); // Reload data
  }

  function getLastTen(data) {
    return data.slice(-10).reverse(); // get last 10 rows
  }

  function renderTable(data) {
    const recentTransactionsDiv = document.getElementById("recentTransactions");

    let html = `
      <h5>Latest 10 Entries</h5>
      <table id="myTable" border="1" style="border-collapse:collapse;width:100%;">
        <tr>
          <th>#</th>
          <th>Invoice</th>
          <th>Date</th>
          <th>Mobile No.</th>
          <th>Customer</th>
          <th>Item / Description</th>
          <th>Amount</th>
        </tr>
    `;
    data.forEach((row) => {
      const invoice = `${row[1] || ''}/${row[2] || ''}`;
      const date = row[7] || '';
      const mobile = row[3] || '';
      const customer = `${row[4] || ''} | Address: ${row[5] || ''}`;
      const item = `${row[8] || ''} | ${row[9] || ''}`;
      const amount = row[15] || "0.00";
      const srn = row[0] || "0";

      html += `
        <tr>
          <td>${srn}</td>
          <td style="color:blue; cursor:pointer; text-decoration:underline;" onclick="showInvoice('${row[1]}','${row[2]}')">${invoice}</td>
          <td>${date}</td>
          <td>${mobile}</td>
          <td>${customer}</td>
          <td>${item}</td>
          <td>${amount}</td>
        </tr>
      `;
    });
    html += "</table>";
    recentTransactionsDiv.innerHTML = html;
  }

  // ============================
  // üîç Invoice Popup Generator
  // ============================

  function showInvoice(fy, invNo) {
    const viewer = document.getElementById("invoice-view");
    viewer.innerHTML = "";

    const row = gcdata.find(r => r[1] === fy && r[2] === invNo);
    if (!row) {
      viewer.innerHTML = "<p>No data found for this Invoice.</p>";
      document.getElementById("invoicePopup").style.display = "flex";
      return;
    }

    const [sr, fyNo, invNum, mob, cname, addr, ttype, date, item, desc, hsn, qty, unit, saleType, gst, invAmt, , type, gstin] = row;
    const gstPerc = parseFloat(gst || 0);
    const invAmtNum = parseFloat(invAmt || 0);
    const taxBase = invAmtNum / (1 + gstPerc / 100);
    const gstHalf = gstPerc / 2;
    const gstAmt = taxBase * (gstHalf / 100);

    viewer.innerHTML = `
      <div class="invoice">
        <h2 style="text-align:center;">Tax Invoice</h2>
        <p><strong>GUPTA COMMUNICATION</strong><br/>
        NEAR PNB BANK, KUNDESHWARI, KASHIPUR (U.S.NAGAR)<br/>
        UTTARAKHAND -244713<br/>
        GSTIN: 05BUKPG1513R1ZG | Phone: +91-7017905658</p>

        <table border="1" style="border-collapse:collapse;width:100%;margin-top:10px;">
          <tr>
            <td><strong>Bill To:</strong><br/><strong>${cname}</strong><br/>
              ${addr}<br/>Mob: ${mob}<br/>Type: ${type}<br/>GSTIN: ${gstin}
            </td>
            <td>
              <strong>Invoice No:</strong> ${fy}/${invNum}<br/>
              <strong>Date:</strong> ${date}<br/>
              <strong>Transaction:</strong> ${ttype}
            </td>
          </tr>
        </table>

        <table border="1" style="border-collapse:collapse;width:100%;margin-top:10px;">
          <tr><th>#</th><th>Item / Description</th><th>HSN</th><th>Qty</th><th>Unit</th><th>Rate</th><th>Taxable</th></tr>
          <tr><td>1</td><td>${item}<br/>${desc}</td><td>${hsn}</td><td>${qty}</td><td>${unit}</td><td>${taxBase.toFixed(2)}</td><td>${taxBase.toFixed(2)}</td></tr>
        </table>

        <table border="1" style="border-collapse:collapse;width:100%;margin-top:10px;">
          <tr><td rowspan="5"><strong>Amount in Words:</strong><br/>${numberToWords(parseInt(invAmtNum))} Only</td><td>Subtotal</td><td>${taxBase.toFixed(2)}</td></tr>
          <tr><td>CGST (${gstHalf}%)</td><td>${gstAmt.toFixed(2)}</td></tr>
          <tr><td>SGST (${gstHalf}%)</td><td>${gstAmt.toFixed(2)}</td></tr>
          <tr><td><strong>Total</strong></td><td>${invAmtNum.toFixed(2)}</td></tr>
        </table>

        <p><strong>Declaration:</strong> We declare this invoice shows actual price and details are true.</p>
        <p style="text-align:right;">Authorised Signatory<br/>Gupta Communication</p>
        <p style="text-align:center;">Thank you for your business!</p>
      </div>
    `;

    document.getElementById("invoicePopup").style.display = "flex";
  }

  function closePopup() {
    document.getElementById("invoicePopup").style.display = "none";
  }

  // =======================
  // üßæ Print Invoice
  // =======================
  function printInvoice() {
    const win = window.open('', '', 'height=700,width=900');
    win.document.write('<html><head><title>Print Invoice</title><style>body{font-family: Arial;} table{width:100%;border-collapse:collapse;} th, td{border:1px solid #000;padding:5px;text-align:left;}</style></head><body>');
    win.document.write(document.getElementById('invoice-view').innerHTML);
    win.document.write('</body></html>');
    win.document.close();
    win.print();
  }

  // ===========================
  // üî§ Convert Number to Words
  // ===========================
  function numberToWords(num) {
    if (num === 0) return "Zero";
    const belowTwenty = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten",
      "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen",
      "Eighteen", "Nineteen"];
    const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
    const thousands = ["", "Thousand", "Lakh", "Crore"];

    function helper(n) {
      if (n === 0) return "";
      else if (n < 20) return belowTwenty[n] + " ";
      else if (n < 100) return tens[Math.floor(n / 10)] + " " + helper(n % 10);
      else return belowTwenty[Math.floor(n / 100)] + " Hundred " + helper(n % 100);
    }

    let word = "", i = 0;
    while (num > 0) {
      if (num % 1000 !== 0) {
        word = helper(num % 1000) + thousands[i] + " " + word;
      }
      num = Math.floor(num / 1000);
      i++;
    }
    return word.trim();
  }

  // ===========================
  // üîç Search Function
  // ===========================
  document.addEventListener("DOMContentLoaded", () => {
    gcdataLoad();

    document.getElementById("searchInput").addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase().trim();

      if (searchTerm === "") {
        renderTable(getLastTen(gcdata)); // show last 10 if input empty
      } else {
        const filteredData = gcdata.filter(row =>
          row.some(cell => (cell || '').toLowerCase().includes(searchTerm))
        );
        renderTable(filteredData);
      }
    });
  });
</script>



<!-- ---------------------------------------------------- GC SALE CREAT ENTRY SCRIPT STOP --------------------------------------------------------------------------------- -->













 


<!-- =============================== VOUCHER FORM butto POUP and script and form start ============================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voucher Popup (Non-interactive 35% Overlay)</title>

<style>
/* ==== POPUP BACKGROUND (Overlay) ==== */
#popupVOUCHEROverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.35); /* ‚úÖ 35% transparent black overlay */
  z-index: 999;
  pointer-events: auto; /* ‚úÖ block all clicks behind popup */
}

/* ==== POPUP BOX ==== */
.voucher-popup {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 12px;
  width: 70%;
  max-width: 900px;
  padding: 20px 30px;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  animation: fadeIn 0.3s ease-in-out;
  font-family: Arial, sans-serif;
  z-index: 1000;
}
@keyframes fadeIn {
  from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
  to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

/* ==== CLOSE BUTTON ==== */
.voucher-popup .closeBtn {
  position: absolute;
  top: 10px; right: 15px;
  background: #ff3c3c;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px; height: 30px;
  font-weight: bold;
  cursor: pointer;
}

/* ==== POPUP FORM ELEMENTS ==== */
.voucher-popup label {
  font-weight: bold;
  display: block;
  margin-top: 8px;
}
.voucher-popup input,
.voucher-popup select {
  margin-top: 5px;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 100%;
}
.voucher-popup input[type="submit"],
.voucher-popup .fetchbtn {
  background: #04a777;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  margin-top: 10px;
  cursor: pointer;
}
.voucher-popup input[type="submit"]:hover,
.voucher-popup .fetchbtn:hover {
  background: #03885f;
}
.voucher-popup h2 {
  text-align: center;
  color: #003366;
}

/* ==== FORM SECTIONS ==== */
.form-section { display: none; }
.form-section.active { display: block; }

/* ==== DISABLE BACKGROUND INTERACTION ==== */
body.popup-active {
  overflow: hidden;          /* ‚úÖ Disable scrolling */
  user-select: none;         /* ‚úÖ Disable text selection */
  pointer-events: none;      /* ‚úÖ Disable clicks */
}
body.popup-active #popupVOUCHEROverlay,
body.popup-active .voucher-popup {
  pointer-events: auto;      /* ‚úÖ Allow interaction only with popup */
}
</style>
</head>
<body>




<!-- ==== POPUP OVERLAY ==== -->
<div id="popupVOUCHEROverlay"></div>

<!-- ==== POPUP BOX start hare ==== -->
<div id="popupVOUCHERBox" class="voucher-popup" style="display:none;">
  <button class="closeBtn" onclick="closeVOUCHERPopup()">√ó</button>
  <h2 id="popupTitle">Voucher Form</h2>

 <!-- ==== VBTN1 FORM start ==== -->
  <div id="vbtn1" class="form-section">
   
    

            <form id="mainForm">
               
<div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">
  <div style="display: flex; align-items: center; gap: 8px;">
<span style="color:grey;font-size:80%;font-family:Magneto;">eS|MTally</span>
</div>

  <div style="display: flex; align-items: center; gap: 8px;">
 <select id="fy" name="fy" required>   <option value="25-26">FY (25-26)</option> </select>
</div>

 </div>  
                  <h5 style="background-color: rgb(4, 119, 154);text-align: center;"><span style="color: #f5f9f5 ;font-size:100%;"> <strong> Creat New Invoice </strong></span> </h5>
            
            
                  <input type="hidden" name="timestamp" id="timestamp">
            

<div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
<label for="ivn" style="color: rgb(176, 3, 20);">Invoice No.</label>  
<input type="number" id="ivn" name="ivn" placeholder="Enter Invoice No." required>
</div>

<div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
<label for="mobileNo" style="color: rgb(176, 3, 20);">Mobile No:</label>
<input type="number" id="mobileNo" name="mobileNo" placeholder="Enter mobile number" required>
</div>

 </div>         
                


 <div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">
  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
 <label for="ttype" style="color: rgb(176, 3, 20);">Transaction Type:</label>
                  <select id="ttype" name="ttype" required>
                    <option value="">Select T. Type</option>
                    <option value="Cash">Cash</option>
                    <option value="Bank">Bank</option>
                    <option value="UPI">UPI</option>
                    <option value="Finance">Finance</option>
                  </select>
</div>

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
 <label for="date" style="color: rgb(176, 3, 20);">Invoice Date:</label>
<input type="date" id="date" name="date" required>
</div>

 </div>  
            
                  <label for="customerName" style="color: rgb(176, 3, 20);">Customer Name:</label>
                  <input type="text" id="customerName" name="customerName" placeholder="Enter customer name" required>
            
                  <label for="address" style="color: rgb(176, 3, 20);">Address:</label>
                  <input type="text" id="address" name="address" placeholder="Enter address" required>
            
                 
            
                  
            
                  <label for="itemName" style="color: rgb(176, 3, 20);">Item Name:</label>
                  <select id="itemName" name="itemName" required>
                    <option value="">Select an item</option>
                    <option value="Mobile">Mobile</option>
                    <option value="Headphone">Headphone</option>
                    <option value="Other">Other</option>
                  </select>
            
                  <label for="description" style="color: rgb(176, 3, 20);">Item Description:</label>
                  <input type="text" id="description" name="description" placeholder="Enter Item Description/ S.No., Colour.." required>

                  


  <div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">
  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
<label for="hsn" style="color: rgb(176, 3, 20);">HSN:</label>
 <input type="number" id="hsn" name="hsn" placeholder="Enter HSN code" required>
</div>

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
 <label for="qty" style="color: rgb(176, 3, 20);">Quantity:</label>
 <input type="number" id="qty" name="qty" placeholder="Enter quantity" required>
</div>

 <div style="display: flex; align-items: center; gap: 8px;">
  <label for="unit" style="color: rgb(176, 3, 20);">Unit:</label>
                  <select id="unit" name="unit" required>
                    <option value="">Select unit</option>
                    <option value="Pcs">Pieces</option>
                    <option value="Box">Box</option>
                  </select>
</div>

 </div>  


  <div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">
  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
<label for="saleType" style="color: rgb(176, 3, 20);">Sale Type:</label>
                  <select id="saleType" name="saleType" required>
                    <option value="">Select Sale Type</option>
                    <option value="State Sale">Local Sale</option>
                    <option value="Interstate Sale">Interstate Sale</option>
                  </select>
</div>

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
   <label for="gst" style="color: rgb(176, 3, 20);">GST %:</label>
                  <select id="gst" name="gst" required>
                    <option value="">Select GST%</option>
                    <option value="18">18%</option>
                    <option value="5">5%</option>
                    <option value="40">40%</option>
                  </select>
</div>

 <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
    <label for="totalAmt" style="color: rgb(176, 3, 20);">Total Amt:</label>
<input type="number" id="totalAmt" name="totalAmt" placeholder="Enter Total Amount" required>
</div>

 </div>  
                

 

<div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
  <!-- GST Option -->
                  <label for="gst-option" style="color: rgb(176, 3, 20);">Registration Type:</label>
                  <select id="gst-option" name="type" onchange="handleOptionChange()" required>
                    <option value="">Select</option>
                    <option value="Unregistered/Consumer">Unregistered</option>
                    <option value="Regular">Regular</option>
                  </select>
</div>

<div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
              <div id="input-container" style="display:none;">
                    <label for="dynamic-input" style="color: rgb(115, 3, 14);">Enter GST No.:</label>
                    <input type="text" id="dynamic-input" name="gstin" placeholder="Enter GSTIN No." />
                  </div>
</div>

 </div>      
            

            
                  <input type="submit" id="submitButton" value="Save Invoice">

<h5 style="background-color: rgb(154, 34, 4);text-align: center;"><span style="color: #f5f9f5 ;font-size:100%;"> <strong> Modify Invoice </strong></span> </h5>
            
              
              

<div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">
  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
<label for="sNo" style="color: #920101 ;font-size:100%;">Enter Sr. No</label>
<input type="number" id="sNo" name="sNo" placeholder="Enter Seril No ..." >
</div>

  <div style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
    <!-- Wait message div -->
<div id="waitMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
            
<input type="button" value="Fetch Data" onclick="fetchData()">
<button type="button" id="modifyButton" onclick="modifyEntry()" style="display:none;">Modify Entry</button>
</div>

 </div>  

 </form>

            
              <script>
                const form = document.getElementById("mainForm");
                const submitButton = document.getElementById("submitButton");
            
                form.addEventListener("submit", function(event) {
                    event.preventDefault(); // Form ko reload hone se roke
                    submitButton.disabled = true; // Button ko disable kare
                    submitButton.value = "Wait.."; // Button ka text badle
                    
                    // Form data process hone ke baad button firse enable karne ke liye (Optional)
                    setTimeout(() => {
                        submitButton.disabled = false; 
                        submitButton.value = "Submit"; // Wapas text badle
                        form.reset(); // Form reset kare
                    }, 3000); // 3 second ke baad button wapas enable
                });
            </script>
            
            
              <script>
                function handleOptionChange() {
                  const selectedOption = document.getElementById("gst-option").value;
                  const inputContainer = document.getElementById("input-container");
                  const dynamicInput = document.getElementById("dynamic-input");
            
                  if (selectedOption === "Regular") {
                    inputContainer.style.display = "block";
                    dynamicInput.value = ""; // Reset input value
                  } else if (selectedOption === "Unregistered/Consumer") {
                inputContainer.style.display = "none";  // Hide input container for this option
                // Set default value as 'URP'
                dynamicInput.value = "URP";
              }
                  
                  else {
                    inputContainer.style.display = "none";
                  }
                }
            
                function updateOptionValue() {
                  const inputValue = document.getElementById("dynamic-input").value;
                  const RegularOption = document.querySelector("#gst-option option[value='Regular']");
            
                  if (RegularOption && inputValue !== "") {
                    RegularOption.value = `Regular-${inputValue}`; // e.g., Regular-50
                  } else if (selectedOption === "Unregistered/Consumer") {
                // If "Unregistered/Consumer" is selected, set the value as 'URP'
                RegularOption.value = "URP"; 
              }
              else {
                    RegularOption.value = "Regular"; // Reset to default
                  }
                }
            
                
              </script>



  </div>      <!-- ==== VBTN1 FORM stop ==== -->

  <!-- ==== VBTN2 FORM START ==== -->
  <div id="vbtn2" class="form-section">  </div>      <!-- ==== VBTN2 FORM STOP ==== -->

  <!-- ==== BANK FORM ==== -->
  <div id="bankForm" class="form-section">
    <h3>Bank Form</h3>
    <p>Yahan aapka bank form ka content aayega...</p>
  </div>


</div>  <!-- ==== POPUP BOX stop hare ==== -->

<script>
/* ==== BUTTON CLICK TO OPEN SPECIFIC FORM ==== */
document.querySelectorAll('button[data-target]').forEach(btn => {
  btn.addEventListener('click', e => {
    const sectionId = e.target.getAttribute('data-target');
    openPopup(sectionId, e.target.innerText);
  });
});

/* ==== POPUP OPEN FUNCTION ==== */
function openPopup(sectionId, title) {
  document.body.classList.add("popup-active"); // ‚úÖ Lock background
  document.getElementById('popupVOUCHEROverlay').style.display = 'block';
  document.getElementById('popupVOUCHERBox').style.display = 'block';
  document.getElementById('popupTitle').innerText = title;

  document.querySelectorAll('.form-section').forEach(div => div.classList.remove('active'));
  document.getElementById(sectionId)?.classList.add('active');
}

/* ==== POPUP CLOSE FUNCTION ==== */
function closeVOUCHERPopup() {
  document.body.classList.remove("popup-active"); // ‚úÖ Unlock background
  document.getElementById('popupVOUCHEROverlay').style.display = 'none';
  document.getElementById('popupVOUCHERBox').style.display = 'none';
}
</script>

</body>
</html>

<!-- =============================== VOUCHER FORM butto POUP and script and form stop ============================================ -->
