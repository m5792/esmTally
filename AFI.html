  <!-- üîπ Footer -->

  <style>
  body {
    margin: 0;
    padding-bottom: 60px; /* Footer ke liye space */
    font-family: Arial, sans-serif;
  }

  /* üîπ Fixed Footer */
  .fixed-footer {
      position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #a7a8a8;
    color: rgb(1, 49, 77);

    text-align: center;
    padding: 2px 2px; /* Top-Bottom = 0, Left-Right = 10px gap */
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.3);
  }
</style>

<!-- footer start hare) -->
  <div class="fixed-footer">

    <!-- Current Time -->
 <div style="display: flex; justify-content: center; align-items: center; background-color: #f7f8fa; color: rgb(1, 1, 1); font-size: 12px; font-weight: bold;  border: 5px solid #003444; ">
  <div id="currentDateTime" style="padding: 5px 10px; white-space: nowrap; font-size: 16px; "></div>

  
  <span id="todayEvent" style="color: rgb(0, 65, 69);font-weight: bold;font-size: 14px; "></span>
</div>

<!-- ================================================================================================================================== -->
    <div style="
    max-width: 100%;
    margin: 15px auto;

    border-radius: 12px;
    background: #dbf7f2;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    font-family: Arial, sans-serif;
">

    <h2 style="margin:0; color:#004750; text-align:center;">
         A.F.I Cure Medical Store
    </h2>

    <hr style="margin:6px 0; border:0; border-top:1px solid #cfcfcf;">

    <strong style="margin:6px 0;"><strong>üè¢ Propriter:</strong> Mukhtar Ahamad</strong> </br>
    <strong style="margin:6px 0;"><strong>üìç Address:</strong> Near PNB Bank Kundeshwari, Kashipur U.S.Nagar, Uttarakhand-244713</strong></br>
    <strong style="margin:6px 0;"><strong>üìû Contact:</strong> +91 9756735792, 8057925792</strong> ,
    <strong style="margin:6px 0;"><strong>üìß Email:</strong> eservicesksp@gmail.com</strong></br>
    <strong style="margin:6px 0;"><strong>üíº DL No:</strong> UA-UDH-143538 | UA-UDH-143539  (Exp. 07-Nov-2030)</strong>

   <hr style="margin:6px 0; border:0; border-top:5px solid #860303;">

 
</div>

<!-- ================================================================================================================================== -->





<!-- ============ website open navgation buttan code start hare  ========= -->
<style>
    :root{ --gap:5px; --btn-bg:#1e1d1d; --btn-border:#6a6a6a; --radius:10px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  
    .rownav{ display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap; justify-content: center;}

    .item{ display:flex; align-items:center; gap:10px; padding:4px 12px; background:var(--btn-bg); border:1px solid var(--btn-border); border-radius:var(--radius); box-shadow:0 6px 18px rgba(0,0,0,0.05); text-decoration:none; color:#111; }
    .item img{ width:25px; height:25px; object-fit:cover; border-radius:8px; }
    .name{ font-weight:700; font-size:14px; color: white;}

    @media (max-width:560px){ .rownav{ width:100%; flex-direction:column; align-items:stretch; } .item{ width:100%; } }
  </style>
</head>
<body>
  <nav class="rownav" aria-label="Quick image links" style=" border: 3px solid #03495a; padding: 5px 10px;background-color: black;">


     <!-- Google (favicon used as image) -->
    <a class="item" href="https://www.google.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn.dribbble.com/users/1717214/screenshots/4124610/g-logo.gif" alt="Google" width="50" height="50" />
      <span class="name">Google</span>
    </a>

     <!-- Gmail (favicon used as image) -->
    <a class="item" href="https://mail.google.com/mail/u/0/" target="_blank" rel="noopener noreferrer">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjpEIz6vZxfKx_cLh8Y6tDWalIuwi08MCggUEXk8cXLAy8NUilIHwNgrsjtFIxgEWCWAE&usqp=CAU" alt="Google" width="50" height="50" />
      <span class="name">Gmail</span>
    </a>

      <!-- youtube (favicon used as image) -->
    <a class="item" href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2019/07/371907120_YOUTUBE_ICON_TRANSPARENT_400.gif" alt="Google" width="50" height="50" />
      <span class="name">You Tube</span>
    </a>

       <!-- pnb natbanking (favicon used as image) -->
    <a class="item" href="https://ibanking.pnb.bank.in/" target="_blank" rel="noopener noreferrer">
      <img src="https://i0.wp.com/www.logotaglines.com/wp-content/uploads/2016/08/Punjab-National-Bank-Logo.jpg?resize=400%2C391" alt="Google" width="50" height="50" />
      <span class="name">PNB Natbanking</span>
    </a>

    <!-- WhatsApp (user-provided gif) -->
    <a class="item" href="https://web.whatsapp.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2021/08/372108180_WHATSAPP_ICON_400.gif" alt="WhatsApp" width="50" height="50" />
      <span class="name">WhatsApp</span>
    </a>

    <!-- Facebook (user-provided gif) -->
    <a class="item" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTZuaHQ1ZjdnajNwMWtrZHVhN3Q4djdwMDZmYWZuYzRoYTA0Ymx4MiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/IeRI0TleieCJ6ytPUr/giphy.gif" alt="Facebook" width="50" height="50" />
      <span class="name">Facebook</span>
    </a>

   

    <!-- Chat GPT (favicon) -->
    <a class="item" href="https://chatgpt.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://static.vecteezy.com/system/resources/previews/022/841/114/original/chatgpt-logo-transparent-background-free-png.png" alt="Gmail" width="50" height="50" />
      <span class="name">Chat GPT</span>
    </a>

    <!-- html mipl (PNB favicon) -->
    <a class="item" href="https://m5792.github.io/esm/" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn-icons-png.flaticon.com/512/1197/1197396.png" alt="PNB Netbanking" width="50" height="50" />
      <span class="name">MIPL Dashboard</span>
    </a>

      <!-- html mipl (PNB favicon) -->
    <a class="item" href="https://www.netflix.com/browse" target="_blank" rel="noopener noreferrer">
      <img src="https://media.tenor.com/miBRlkp03LkAAAAj/netflix.gif" alt="Netflix" width="50" height="50" />
      <span class="name">Netflix</span>
    </a>


  <!-- small script: open links with Enter when focused for accessibility -->
  <script>
    document.querySelectorAll('.item').forEach(el=>{
      el.addEventListener('keydown', e=>{ if(e.key === 'Enter' || e.key === ' ') el.click(); });
    });
  </script>


<!-- ============ website open navgation buttan code start stop  ========= -->









  </nav>
  </div>  <!-- footer stop hare -->






<!-- ==========  ------------------------------------------xxxxxxxxxxxxxxxxxxxxx-----------------------------------------======================= -->

<!-- ===============================
     AFI STOCK UI (BUTTON MODE)
================================== -->


<style>


/* Table Styling */
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}

 
 /* Table container ************/
table{
    width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;

  }

/* Optional heder alwayas fix on top and table scrolling  */
  table{
  overflow-x: auto;
  display: block;
  max-height: 500px; /* Optional scrolling */
  }

  /* Table border & cell style */
th {
   background: #272727;
  color: #ffffff;
  padding: 7px;
  border: 1px solid #b5b5b5;
  text-align: left;
  font-weight: 14px;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
  border-bottom:5px solid #decf02;
  }


 td {
   padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
  }

  /* Header design */


  tr:nth-child(even) {
  background-color: #f9f9f9;
}

  /* Row hover effect */
  tr:hover td {
   background: #fccc49;
 color: rgb(0, 15, 15);
  transition: background-color 1s ease, color 1s ease;
  }
    


.filter-btn {
  background: #002044;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
  transition: background 0.2s ease;
  min-width: 90px;            /* optional: makes buttons uniform width */
  text-align: center;
}
.filter-btn:hover {
  background: #025bc2;
}
.filter-btn.active {
  background: #0390e1;
  color: rgb(252, 250, 250);
  font-weight: bold;
}


</style>
 

   <h3 style="text-align:center; background-color: #002630; color: #ebf7fa; font-weight: bold;width: 100%; border-bottom:5px solid #840a01;">A.F.I Cure Medicine Serch Report</h3> 
 
<div id="mipl2011Buttons" style="display: flex; gap: 10px; border-bottom:5px solid #02821e; flex-wrap: wrap; justify-content: center; margin-bottom: 5px; background-color: #002044;  padding: 2px 2px;">
<strong style="color: #014fa8; font-size: 25px; font-weight: bold;">|</strong>
  <!-- BUTTONS -->

  <button class="filter-btn" id="openAFICMBtn" data-value="AFICM">‚ûï Create Purchase/Sale (<span style="color: rgb(245, 183, 158); font-weight: bold;">F4</span>)</button>

 

    <button class="filter-btn" id="searchBtn" data-mode="afisearch">üîç Searchbar (<span style="color: rgb(245, 183, 158); font-weight: bold;">F3</span>)</button>
    <button class="filter-btn" id="searchDRUG" data-mode="DNAME"> Search By Drug Name (<span style="color: rgb(245, 183, 158); font-weight: bold;">F6</span>)</button>
    <button class="filter-btn" data-mode="SALT">Search By Salt</button>
    <button class="filter-btn" id="pswBtn" data-mode="PSW">üìò ID/Password</button>

    <button onclick="print2011Report()" style="border: none; color: rgb(248, 209, 209); font-weight: bold;  cursor: pointer; background-color: #002044;">üñ®Ô∏è Print Report</button>

  <button id="refreshAFIDATABtn" style="border: none; color: rgb(206, 246, 206); font-weight: bold;  cursor: pointer; background-color: #002044;"> üîÑ Refresh</button>




  
<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, Dropdown URL  Script Start Heare -->
<!DOCTYPE html>
<html>
  <title> AFI Cure Medical</title>
<head>

    <script>
        // Function to handle dropdown selection
        function handleDropdownChange() {
            const dropdown = document.getElementById('linkDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            if (selectedOption.value) {
                // Open the link in a new tab
                window.open(selectedOption.value, '_blank');
            }
        }
    </script>
    <style>
        select {
            padding:5px;
            font-size: 14px;
            margin: 2px 0;
        }
    </style>
</head>
<body>

  <div style="text-align: left;">
 <strong style="color: #014fa8; font-size: 25px; font-weight: bold;">|</strong>
    <select id="linkDropdown" onchange="handleDropdownChange()" style="border-radius: 8px; border: none; background-color: #002044; color: white;">
        <option value=""  style="text-align: center; font-weight: bold; "> Select Other Menu </option>
		<option value="https://drive.google.com/drive/folders/1Dc4In3NfpKdFdOLqcgyTFNC2tch7b6q2?usp=sharing"   style="color: rgb(239, 246, 175);">AFI Drive</option>

  	<option value="https://m5792.github.io/esm/mdashboard.html">	Daybook MIPL</option>
    <option value="mcalculator">	Margin Calculator</option>
    	<option value="https://www.google.com/android/find/">	Find My Device</option>
	<option value="https://docs.google.com/spreadsheets/d/1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss/edit?gid=627393391#gid=627393391">	Store Database Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/1U_jwvZNtFuP91Gljjrbz_cpmb1OIkeDHnKa7aDe7F20/edit?gid=1511450281#gid=1511450281">	Clint List Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/17GZv2O6uupdA5r6p7-zqKZ8AQgZozbGQf2aXPlUzhDA/edit?gid=1122888223#gid=1122888223">	Mipl Office</option>
	<option value="https://docs.google.com/spreadsheets/d/13N0HBuorZJM-ARnlTh36EUaD1-uQckaC6sLLzMnWAks/edit?gid=696561165#gid=696561165">	Office Noida</option>
	<option value="https://docs.google.com/spreadsheets/d/1Rw_6cDYP-ETicn9YhHkdF_Sgmi8ps5JhjhlrkWvtwRQ/edit?gid=2123243236#gid=2123243236">	GUPTA CAMUNICATION Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4/edit?gid=0#gid=0">	INDEX SHEET MIPL Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?gid=147958071#gid=147958071">	MIPL Clint Cash Ledger Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0/edit?gid=0#gid=0">	Cash Management Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA/edit?gid=0#gid=0">	Imprest Voucher Sheet*</option>
      <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?pli=1&gid=207048997#gid=207048997">	MIPL Party Weight REport*</option>
     <option value="https://docs.google.com/spreadsheets/d/1C4EeSbCDaVGmJjU3QY2VNfI_IEZn0tZsqXw0ss3G58k/edit?gid=809921823#gid=809921823" style="color: rgb(175, 219, 246);">	ESS Google Index Sheet*</option>
       <option value="https://docs.google.com/spreadsheets/d/1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw/edit?gid=2031012173#gid=2031012173" style="color: rgb(246, 175, 175);">	Password  Google  Sheet*</option> 
     <option value="https://docs.google.com/spreadsheets/d/1g_hAVEIFZRnRNFFQWF275Y_AXKBTw0UIP0xiH4_C2V0/edit?gid=0#gid=0" style="color: rgb(239, 246, 175);">	A.F.I Google Index Sheet*</option> 
     <option value="https://m5792.github.io/esm/">	MIPL DASHBOARD</option>
     <option value="https://m5792.github.io/esm/MULTITECH2023.html">MIPL Old Dashboard</option>
     <option value="https://github.com/">	github (mukhtarahamadksp@gmail.com)</option>
     <option value="https://m5792.github.io/esm/eTally.html">	eTally Dashboard</option>

    </select>


    <script>
function handleDropdownChange() {
    const dropdown = document.getElementById("linkDropdown");
    const val = dropdown.value;

    // -------- 1Ô∏è‚É£ Function Option (Margin Calculator) --------
    if (val === "mcalculator") {
        if (typeof openMRGNPrompt === "function") {
            openMRGNPrompt();

            // After running ‚Äî focus pRate & clear
            setTimeout(() => {
                const pRate = document.getElementById("pRate");
                if (pRate) {
                    pRate.focus();
                    pRate.value = "";
                }
            }, 50);
        }

        dropdown.value = ""; // reset dropdown
        return;
    }

    // -------- 2Ô∏è‚É£ All URL options open in NEW TAB --------
    if (val && val.startsWith("http")) {
        window.open(val, "_blank"); // open new tab
        dropdown.value = "";        // reset dropdown
        return;
    }

    // Otherwise nothing
}

    </script>


</body>
</html>
</div>

</div>

<style>
  #search2011Bar {
    background-color: #013570; /* blue */
    width: 100%;
    height: 20px;
    display: flex;
    align-items: center;
    padding: 20px;
    gap: 10px;
    box-sizing: border-box;
  }

  #search2011Input {
    flex: 1;
    background-color: #fdfdf6; /* grey */
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search2011Bar label {
    font-weight: bold;
    color: rgb(247, 244, 244);
    margin-left: 10px;
  }

  #search2011Bar input[type="date"] {
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

 .dropdown {
  position: absolute;
  top: 140px;
  left: 0;
  right: 0;
  background: rgb(254, 255, 255);
  border: 4px solid #012228;
  max-height: 530px;
  width: 800px;
  overflow-y: auto;
  display: none;
  z-index: 100;
}

.dropdown div { padding: 6px; cursor: pointer; }
.dropdown div.active { background: #0078d4; color: white; }

.dropdown div:hover {
  background: #e8cd36;
  color: rgb(1, 3, 30);
  font-weight: bold;
}

 
</style>






<div id="search2011Bar">

 <!-- SEARCH INPUT -->
<input type="text" id="afiSearchInput" placeholder="üîç Search Bar on Slected Buttan ...."
       style="display:none; padding:6px; width:100%; border-radius:6px; border:1px solid #ccc;" />

<!-- DROPDOWN (ONLY FOR DNAME + SALT) -->
<div id="afiDropdown" class="dropdown">
</div>
</div>

  <br>

  <!-- TABLE -->
  <div id="afiTableContainer"></div>

  <br>

  <!-- SALT MATCH BOX -->
  <div id="saltMatchBox" style="display:none; padding:10px; margin-bottom:10px;
       background:#fff8d1; border:1px solid #e5ce8e; border-radius:6px;">
  </div>

</div>


<!-- ==========  afi data table script code start ========================== -->



<script>
/* ============================================================
   API + SHEET CONFIG
============================================================ */
const api2011Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";  // ESERVICESKSP@GMAIL.COM API KEY
const sheet2011Id = "1g_hAVEIFZRnRNFFQWF275Y_AXKBTw0UIP0xiH4_C2V0";

const rangeAFI = "FORM!A:N";
const rangeAFIPSW = "PASSWORD!A:M";


const afiSearchInput = document.getElementById("afiSearchInput");
const afiDropdown = document.getElementById("afiDropdown");

let afiData = [];
let pswData = [];
let colB = "";
let colC = "";
let colD = "";
let currentMode = "";

/* ============================================================
   TABLE CONFIG
============================================================ */
const tableConfig = {
  DNAME: { 
    headers: ["Sr No","Type","Drug Name","Salt","Qty","Rate","Amt","Unit","MRP","Q/U","P.Date","E.Date","Ledger","I. Type"],
    cols:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]
  },
  SALT: { 
    headers: ["Sr No","TYPE","SALT","Use / Kis mein hota hai","Drug Name","Category"],
    cols:[0,1,2,3,4,5]
  },
  afisearch: { 
    headers: ["Sr No","TYPE","SALT","Use / Kis mein hota hai","Drug Name","Category","MRP","Q/U","P.Date","E.Date","Ledger","I. Type"],
    cols:[0,1,2,3,4,5,8,9,10,11,12,13]
  },
  PSW: { 
    headers: ["Sr No","TYPE","ID","PASSWORD","OTHER"],
    cols:[0,1,2,3,4]
  }
};

const saltBoxConfig = {
  headers: ["SALT","Use / Kis mein hota hai","Drug Name","Category"],
  cols:[2,3,4,5]
};

/* ============================================================
   LOAD AFI DATA (sorted)
============================================================ */
async function loadAFIData() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${rangeAFI}?key=${api2011Key}`;
  const res = await fetch(url);
  const json = await res.json();

  const rows = json.values || [];
  const headers = rows[0];

  colB = headers[1];
  colC = headers[2];
  colD = headers[3];

  afiData = rows.slice(1).map(r => {
    let obj = {};
    headers.forEach((h,i)=> obj[h] = r[i] || "");
    return obj;
  });

  afiData.sort((a,b)=>(b[headers[0]]||"").localeCompare(a[headers[0]]||"",undefined,{numeric:true}));
}

/* ============================================================
   LOAD PASSWORD DATA
============================================================ */
async function loadPSWData() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${rangeAFIPSW}?key=${api2011Key}`;
  const res = await fetch(url);
  const json = await res.json();

  const rows = json.values || [];
  const headers = rows[0];

  pswData = rows.slice(1).map(r => {
    let obj = {};
    headers.forEach((h,i)=> obj[h] = r[i] || "");
    return obj;
  });
}

/* ============================================================
   BUTTON MODE HANDLER
============================================================ */
document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    // Remove active from all buttons
    document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(b => b.classList.remove("active"));
    // Set current active
    this.classList.add("active");

    currentMode = btn.dataset.mode;

    afiSearchInput.style.display = "none";
    afiDropdown.style.display = "none";
    afiSearchInput.value = "";
    afiTableContainer.innerHTML = "";
    saltMatchBox.style.display = "none";

    /* üî• DROPDOWN ONLY FOR DNAME + SALT */
    if (currentMode !== "DNAME" && currentMode !== "SALT") {
      afiDropdown.style.display = "none";
    }

    /* üîç Global search */
    if (currentMode === "afisearch") { 
      afiSearchInput.style.display = "block";
      startAFISearchMode(); 
      return; 
    }

    /* üîë Password search */
    if (currentMode === "PSW") { 
      afiSearchInput.style.display = "block";
      startPSWSearchMode(); 
      return; 
    }

    /* DNAME + SALT actual searching */
    let filtered = afiData.filter(r => (r[colB]||"").trim().toUpperCase() === currentMode);

    

    /* Sorted unique dropdown list */
   // let uniqueList = [...new Set(filtered.map(r => r[colC]).filter(Boolean))]
     //                  .sort((a,b)=>a.localeCompare(b));


     /* Sorted unique C list (Dropdown me C+D show hoga) */
let uniqueList = [...new Set(filtered.map(r => r[colC]).filter(Boolean))]
                   .sort((a,b)=>a.localeCompare(b));

                   //----
    showAFITable(filtered);

    /* dropdown only shown for these two */
    if (currentMode === "DNAME" || currentMode === "SALT") {
      createAFIDropdown(uniqueList, filtered);
    }
  });
});

/* ============================================================
   DROPDOWN SHOW ONLY ON INPUT CLICK (DNAME+SALT)
============================================================ */
afiSearchInput.addEventListener("click", () => {
  if (
    (currentMode === "DNAME" || currentMode === "SALT") &&
    afiDropdown.innerHTML.trim() !== ""
  ) {
    afiDropdown.style.display = "block";
  }
});

/* ============================================================
   CREATE DROPDOWN
============================================================ */
function createAFIDropdown(list, filteredRows) {

  afiSearchInput.style.display = "block";

  // üî∑ UTILITY: remove duplicates by C+D
  function uniqueRows(rows) {
    const map = new Map();
    rows.forEach(r => {
      const key = `${r[colC] || ""} ${r[colD] || ""}`.trim().toLowerCase();
      if (!map.has(key)) map.set(key, r);
    });
    return Array.from(map.values());
  }

  // üî∑ Make full list unique FIRST
  filteredRows = uniqueRows(filteredRows);

  // üî∑ SORT full list alphabetically (C+D)
  filteredRows.sort((a, b) => {
    let textA = `${a[colC] || ""} ${a[colD] || ""}`.toLowerCase();
    let textB = `${b[colC] || ""} ${b[colD] || ""}`.toLowerCase();
    return textA.localeCompare(textB);
  });

  // üëâ Input click ‚Üí show FULL UNIQUE sorted dropdown
  afiSearchInput.addEventListener("click", () => {
    renderDropdown(filteredRows);
  });

  // üëâ Typing search inside sorted C+D
  afiSearchInput.oninput = () => {
    const v = afiSearchInput.value.toLowerCase().trim();

    let matched = filteredRows.filter(r =>
      (`${r[colC]} ${r[colD]}`.toLowerCase()).includes(v)
    );

    // üî∑ make matched list unique too
    matched = uniqueRows(matched);

    // üî∑ sort matched alphabetical
    matched.sort((a, b) => {
      let textA = `${a[colC] || ""} ${a[colD] || ""}`.toLowerCase();
      let textB = `${b[colC] || ""} ${b[colD] || ""}`.toLowerCase();
      return textA.localeCompare(textB);
    });

    renderDropdown(matched);
  };

  // üëâ Click outside ‚Üí Hide dropdown
  document.addEventListener("click", function (e) {
    if (!afiSearchInput.contains(e.target) && !afiDropdown.contains(e.target)) {
      afiDropdown.style.display = "none";
    }
  });
}



/* ============================================================
   RENDER DROPDOWN ITEMS
   ============================================================ */
/*function renderDropdown(values, filteredRows) {

  // Only show dropdown in DNAME or SALT modes
  if (currentMode !== "DNAME" && currentMode !== "SALT") {
    afiDropdown.style.display = "none";
    return;
  }

  afiDropdown.innerHTML = "";
  afiDropdown.style.display = "block";

  values.forEach(v => {
    let item = document.createElement("div");
    item.textContent = v;

    item.onclick = () => {
      afiDropdown.style.display = "none";
      afiSearchInput.value = v;

      // Filter table rows based on selected dropdown value
      let rows = filteredRows.filter(r => r[colC] === v);
      showAFITable(rows);

      if (currentMode === "DNAME") {
        findSaltRowAndShow(rows[0][colD]);
      }
    };

    afiDropdown.appendChild(item);
  });
}
  */

 function renderDropdown(rows) {

  if (currentMode !== "DNAME" && currentMode !== "SALT") {
    afiDropdown.style.display = "none";
    return;
  }

  afiDropdown.innerHTML = "";
  afiDropdown.style.display = "block";

  rows.forEach(r => {
    let cValue = r[colC];
    let dValue = r[colD];

    let html = `
      <span style="color:red; font-weight:bold;">${cValue}</span>
      ${dValue ? " üíä " + dValue : ""}
    `;

    let item = document.createElement("div");
    item.innerHTML = html;

    item.onclick = () => {
      afiDropdown.style.display = "none";

      // Input me sirf C
      afiSearchInput.value = cValue;

      // Table filter also using only C
      let rows2 = rows.filter(x => x[colC] === cValue);
      showAFITable(rows2);

      if (currentMode === "DNAME") {
        findSaltRowAndShow(dValue);
      }
    };

    afiDropdown.appendChild(item);
  });
}


/* ============================================================
   SALT MATCH BOX
============================================================ */
function findSaltRowAndShow(drugName) {
  const box = document.getElementById("saltMatchBox");

  const matched = afiData.filter(
    r => r[colB] === "SALT" && r[colC] === drugName
  );

  if (!matched.length) {
    box.innerHTML = "<b>No Salt Detail Found</b>";
    box.style.display = "block";
    return;
  }

  let html = `<h4>üîç Salt Match</h4><table border="1" cellpadding="6" style="width:100%; border-collapse:collapse;">`;

  html += "<tr>";
  saltBoxConfig.headers.forEach(h => html += `<th>${h}</th>`);
  html += "</tr>";

  matched.forEach(r => {
    html += "<tr>";
    saltBoxConfig.cols.forEach(c => html += `<td>${Object.values(r)[c]}</td>`);
    html += "</tr>";
  });

  html += "</table>";

  box.innerHTML = html;
  box.style.display = "block";
}

/* ============================================================
   GLOBAL SEARCHBAR
============================================================ */
function startAFISearchMode() {
  afiSearchInput.oninput = () => {
    let v = afiSearchInput.value.toLowerCase();

    let rows = afiData.filter(r =>
      Object.values(r).join(" ").toLowerCase().includes(v)
    );

    rows = highlightMatch(rows, v);
    showAFITable(rows);
  };
}

/* ============================================================
   PASSWORD SEARCH
============================================================ */
function startPSWSearchMode() {
  afiSearchInput.oninput = () => {
    let v = afiSearchInput.value.toLowerCase();

    let rows = pswData.filter(r =>
      Object.values(r).join(" ").toLowerCase().includes(v)
    );

    rows = highlightMatch(rows, v);
    showPSWTable(rows);
  };
}

/* ============================================================
   HIGHLIGHT MATCH
============================================================ */
function highlightMatch(rows, text) {
  if (!text) return rows;

  return rows.map(r => {
    let obj = {};
    Object.keys(r).forEach(k => {
      obj[k] = r[k].replace(new RegExp(text,"gi"), m => `<mark>${m}</mark>`);
    });
    return obj;
  });
}

/* ============================================================
   SHOW AFI TABLE
============================================================ */
function showAFITable(rows) {
  const box = afiTableContainer;
  const cfg = tableConfig[currentMode];

  if (!rows.length) {
    box.innerHTML = "<p>No Data Found</p>";
    return;
  }

  let html = `<table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">`;

  html += "<tr>";
  cfg.headers.forEach(h => html += `<th>${h}</th>`);
  html += "</tr>";

  rows.forEach(r => {
    html += "<tr>";
    cfg.cols.forEach(c => html += `<td>${Object.values(r)[c]||""}</td>`);
    html += "</tr>";
  });

  html += "</table>";
  box.innerHTML = html;
}

/* ============================================================
   SHOW PASSWORD TABLE
============================================================ */
function showPSWTable(rows) {
  const box = afiTableContainer;
  const cfg = tableConfig["PSW"];

  if (!rows.length) {
    box.innerHTML = "<p>No Data Found</p>";
    return;
  }

  let html = `<table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">`;

  html += "<tr>";
  cfg.headers.forEach(h => html += `<th>${h}</th>`);
  html += "</tr>";

  rows.forEach(r => {
    html += "<tr>";
    cfg.cols.forEach(c => html += `<td>${Object.values(r)[c]||""}</td>`);
    html += "</tr>";
  });

  html += "</table>";
  box.innerHTML = html;
}


function print2011Report() {
    // ‡§ú‡§ø‡§∏ DIV ‡§ï‡•ã ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à
    const printContent = document.getElementById('afiTableContainer').innerHTML;

    // ‡§®‡§à Window ‡§ñ‡•ã‡§≤‡§®‡§æ
    const printWindow = window.open('', '', 'width=900,height=700');

    // Print Window ‡§Æ‡•á‡§Ç HTML ‡§≤‡§ø‡§ñ‡§®‡§æ
    printWindow.document.write(`
        <html>
        <head>
            <title>Report Print</title>

            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                }
                table, th, td {
                    border: 1px solid #444;
                    padding: 8px;
                    text-align: left;
                }
                th {
                    background: #f0f0f0;
                }
            </style>
        </head>
        <body>
            ${printContent}
        </body>
        </html>
    `);

    printWindow.document.close();

    // ‡§•‡•ã‡§°‡§º‡•Ä ‡§¶‡•á‡§∞ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‚Üí ‡§´‡§ø‡§∞ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§ñ‡•ã‡§≤‡§®‡§æ
    setTimeout(() => {
        printWindow.print();
        printWindow.close();
    }, 300);
}


//refresh afidata ===================================


// ye function refresh ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§ú‡•ã ‡§≠‡•Ä mode ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à ‡§µ‡§π‡•Ä ‡§µ‡§æ‡§™‡§∏ dikhane ke lye hai .

function applyfreshdataview() {
  if (!currentMode) return;

  afiTableContainer.innerHTML = "";
  afiDropdown.style.display = "none";

  // Global AFI Search
  if (currentMode === "afisearch") {
    startAFISearchMode();
    afiSearchInput.dispatchEvent(new Event("input"));
    return;
  }

  // Password Search
  if (currentMode === "PSW") {
    startPSWSearchMode();
    afiSearchInput.dispatchEvent(new Event("input"));
    return;
  }

  // DNAME / SALT modes
  let filtered = afiData.filter(r => (r[colB] || "").trim().toUpperCase() === currentMode);

  let uniqueList = [...new Set(filtered.map(r => r[colC]).filter(Boolean))]
    .sort((a, b) => a.localeCompare(b));

  showAFITable(filtered);

  if (currentMode === "DNAME" || currentMode === "SALT") {
    createAFIDropdown(uniqueList, filtered);
  }
}



/* ============================================================
   REFRESH AFI DATA FUNCTION
============================================================ */
function refreshAFIData() {
  const btn = document.getElementById("refreshAFIDATABtn");
  if (!btn) return;  // Button missing? Avoid crash.

  btn.disabled = true;
  btn.textContent = "‚è≥ Refreshing...";

  // Re-fetch AFI sheet data
  loadAFIData()
    .then(() => {
      // Re-apply active mode filtering
      applyfreshdataview();

      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;

      alert("‚úÖ Data refreshed successfully!");
    })
    .catch((err) => {
      console.error("Refresh Error:", err);

      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;

      alert("‚ùå Failed to refresh data. Check console for details.");
    });
}

/* Refresh button click handler */
document.getElementById("refreshAFIDATABtn") ?.addEventListener("click", refreshAFIData);
// refresh afidata code stop =====================



/* ============================================================
   LOAD ALL DATA
============================================================ */
loadAFIData();
loadPSWData();



</script>

<!-- ==========  afi data table script code stop ========================== -->

<!-- ==========  ------------------------------------------xxxxxxxxxxxxxxxxxxxxx-----------------------------------------======================= -->














<!-- ==========  id password buttan prompt script start ========================== -->

<script>
// üîÑ Page refresh hote hi password ki memory clear
window.addEventListener("load", function () {
    localStorage.removeItem("pswVerified");
});

// üîç F2 key press ‚Üí search input show + focus
document.addEventListener("keydown", function (e) {
    if (e.key === "F2") {
        const inp = document.getElementById("afiSearchInput");
        inp.style.display = "block";   // show input
        inp.focus();                   // cursor focus
    }
});

document.getElementById("pswBtn").addEventListener("click", function () {

    const correctPassword = "5792"; // ‚≠ê Apna password set karein

    // Agar already verified hai to seedha script run ho jaye
    if (localStorage.getItem("pswVerified") === "true") {
        proceed();
        return;
    }

    let userInput = "";

    // üîÅ Jab tak password correct na ho prompt baar-baar open hoga
    while (userInput !== correctPassword) {

        userInput = prompt("Please enter password:");

        // ‚ùó CANCEL ‚Üí Page reload (no alert)
        if (userInput === null) {
            location.reload(); 
            return;
        }

        // ‚ùå Wrong password
        if (userInput !== correctPassword) {
            alert("‚ùå Incorrect Password! Try again.");
        }
    }

    // ‚úî Password correct ‚Üí save verification
    localStorage.setItem("pswVerified", "true");

    proceed(); 
});

function proceed() {
    alert("‚úî Access Granted!");
    console.log("Password correct ‚Äî proceeding with main script...");
}
</script>

<!-- ==========  id password buttan prompt script stop ========================== -->




   <!-- Current date and time will be displayed here -->
            
<meta name="viewport" content="width=device-width, initial-scale=1.0">
            
<div style="display: flex; flex-direction: row; align-items: center; background-color: #002044; color: rgb(249, 252, 229); font-size: 20px; font-weight: bold;">
  
  <!-- Scrolling News Ticker -->
  <marquee behavior="scroll" direction="left" scrollamount="5" style="flex: 1;">
    <div style="display: inline-flex; align-items: center; gap: 8px;">
    
    </div>
  </marquee>

</div>
 
<script>
function displayCurrentDateTime() {
const now = new Date();

// Formatting options
const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
};

// Formatting date and time
const formattedDateTime = now.toLocaleString('en-US', options);

// Displaying in the div
document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
}

// Call the function on page load to show the current date and time
displayCurrentDateTime();

// Update the date and time every second
setInterval(displayCurrentDateTime, 1000);
</script>
<!-- Current date and time will be displayed Stop -->

<script>
const apiEVENTKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetEVENTId = "1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw";
const rangeEVENT = "EVENT!A:D";



function convertToDate(str) {
    const [d, m, y] = str.split("-");

    const mon = {
        Jan:0, Feb:1, Mar:2, Apr:3, May:4, Jun:5,
        Jul:6, Aug:7, Sep:8, Oct:9, Nov:10, Dec:11
    }[m];

    if (mon === undefined) return null;

    let year = Number(y);

    // allow "yy" and "yyyy"
    if (year < 100) year = 2000 + year;

    return new Date(year, mon, Number(d));
}

async function loadTodayEvent() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const rows = data.values || [];

        let todayEvents = [];
        let yearlyRemaining = [];
        let monthlyRemaining = [];

        const today = new Date();
        today.setHours(0,0,0,0);
        const today_dd = today.getDate();
        const today_mm = today.getMonth();
        const today_yy = today.getFullYear();

        rows.forEach(row => {
            const type = row[0]; 
            const name = row[1];
            const dateStr = row[2];

            if (!dateStr || !name) return;

            let eventDate = convertToDate(dateStr);
            if (!eventDate) return;

            eventDate.setHours(0,0,0,0);

            // --- YEARLY EVENTS ---
            if (type === "Yearly") {
                eventDate.setFullYear(today_yy);
                const diffDays = Math.floor((eventDate - today) / (1000*60*60*24));

                if (diffDays === 0) todayEvents.push(name);
                if (diffDays === 1 || diffDays === 2) {
                    yearlyRemaining.push(
                        `<span style="color:grey"> ‚ú® <span style="color:red">${diffDays} Days Left ‚Äì</span> ${name}</span>`
                    );
                }
            }

            // --- MONTHLY EVENTS ---
            if (type === "Monthly") {
                const eventDay = eventDate.getDate();
                let diffDays = eventDay - today_dd;

                if (diffDays < 0)
                    diffDays += new Date(today_yy, today_mm + 1, 0).getDate();

                if (diffDays === 0) todayEvents.push(name);
                if (diffDays === 1 || diffDays === 2) {
                    monthlyRemaining.push(
                        `<span style="color:#026c96"> ‚ú¶ <span style="color:red">${diffDays} Days Left ‚Äì</span> ${name}</span>`
                    );
                }
            }

            // --- SINGLE EVENT (Exact Date: dd-mm-yyyy) ---
            if (type === "Event") {
                if (
                    eventDate.getDate() === today_dd &&
                    eventDate.getMonth() === today_mm &&
                    eventDate.getFullYear() === today_yy     // FIX Added
                ) {
                    todayEvents.push(name);
                }
            }
        });

        let finalOutput = [];

        if (todayEvents.length > 0) {
            finalOutput.push(
                `<span>‚ú≠ <strong>Today: </strong> ${todayEvents.join(" ‚ú® ")} ‚ú≠</span>`
            );
        }

        if (yearlyRemaining.length > 0) 
            finalOutput = finalOutput.concat(yearlyRemaining);

        if (monthlyRemaining.length > 0) 
            finalOutput = finalOutput.concat(monthlyRemaining);

        document.getElementById("todayEvent").innerHTML =
            finalOutput.length > 0 ? finalOutput.join(" | ") : "";

    } catch (err) {
        console.error(err);
        document.getElementById("todayEvent").innerHTML = "Error loading events";
    }
}

loadTodayEvent();


</script>
 <strong></strong>
<!-- =============== today events script stop ===================== -->






<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ------------------------------ !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->


<!-- ----------------------------------------------------- POPUP OPEN AND CLOSE WITH FORM CODE START HARE ------------------------------------------------------- -->
<!-- ================= POPUP ================= -->
<div id="AFICMPopup" class="popupAFICM-overlay" >
  <div class="popupAFICM-content" style="border: 5px solid #0a0a0a; background-color: #f5f9fb; ">
    <span id="closeAFICMBtn" class="close-btn">&times;</span>

    <h3 style="margin-top:0; color:#00282e; display: flex; justify-content: center; ">A.F.I Medicine Entry</h3>  

    <form id="mainAFICMForm" class="AFICM-form">

         <input type="hidden" name="SNo" id="sNo" />

          <input type="hidden" name="Timestamp" id="TimestampAFICM" />

      <!-- ROW 1 -->
      <div class="row" style="background-color: #f5f9d5; padding: 5px 10px; ">

        
        <label>V.Type:*</label>
        <select id="afi01" name="Type" required>
          <option value="">Select</option>
          <option value="DNAME">Purchase Voucher</option>
          <option value="SALE">Sale Voucher</option>
        </select>

        <label>Date:*</label>
        <input type="date" id="afi02" name="esmK" required>

         <label>Ledger:*</label>
        <select id="afi03" name="esmM"  required> </select>
        <input type="text" id="afi03_manual" placeholder="Type manually..." style="display:none;margin:5px 0;">

      </div>

      <!-- ROW 2 -->
      <div class="row" style="background-color: #d5f5f9; padding: 5px 10px;">
       

        <label>Drug/Item Name:*</label>
         <!--   <input type="text" id="afi04" name="esmC" placeholder="üîç Type Drug Name..."> -->
         <select id="afi04" name="esmC" required > </select>

         <label>Salt Name:</label>
          <!--  <input type="text" id="afi05" name="esmD" placeholder="üîç Type Drug Name..."> -->

         <select id="afi05" name="esmD"> </select>
      </div>

      <!-- ROW 3 -->
      <div class="row" style="background-color: rgb(244, 200, 200); padding: 5px 10px;">
        <label>Qty:*</label>
        <input type="number" id="afi06" name="esmE" placeholder="Enter Qty" style="width:1.2in;" required>
        


        <label>Unit:*</label>
        <select id="afi07" name="esmH" style="width:1in;" required>
          <option value="">Select</option>
          <option>S</option>
          <option>B</option>
          <option>SYP</option>
          <option>CPS</option>
          <option>INJ</option>
          <option>TUBE</option>
          <option>Pc</option>
          <option>Box</option>
          <option>NA</option>
        </select>

        <label>Net Amt:*</label>
        <input type="number" id="afi08" name="esmG" placeholder="Enter Amount" style="width:1.8in;" required step="any">

         <label>MRP:</label>
        <input type="number" id="afi11" name="esmI" placeholder="Enter MRP"  step="any">


         
      </div>

      <!-- ROW 4 -->
      <div class="row">

       
    
       
        <label>Rate:</label>
        <input type="number" id="afi10" name="esmF" readonly placeholder="Auto Rate">

        <label>Exp Date:</label>
        <input type="date" id="afi12" name="esmL" >

            <label>/Unit Details:</label>
        <input type="text" id="afi13" name="esmJ" placeholder="Enter Medicine Details">



          <label>I. Type:*</label>
        <select id="afi14" name="esmN" style="width:1in;" required>
          <option value="">Select</option>
          <option>Ethical</option>
          <option>Generic</option>
          <option>Gen</option>
          <option>Sgl</option>
        </select>

      </div>




   <input type="submit" id="submitAFICMButton" value="Submit" style="padding:8px 16px; background:#035b67; color:white; border:none; border-radius:6px; cursor:pointer;">
  
   <span id="result" style="font-weight:bold; font-size:16px; color: green; text-align: right;"></span>

    <strong> <button id="openMODIFYBtn" data-value="AFICM" style="width: 2in; color: #002044; cursor: pointer; font-weight: bold; background-color: #f8f9fa; border: none; cursor: yes;">üè¢ Click to Modify</button>   
     Fetched Sr No: <span id="fetchedSRNo" style="color: rgb(150, 3, 3);"></span> <br/>
    
   
    </strong>

     <strong id="waitAFIMessage" style="display:none;  color:rgb(184, 3, 3); font-size:16px;text-align: center; font-weight:bold; margin-top:10px;"></strong>

   
    </form>

    

  </div>
</div>




<script>

// -------------------------
// 1) MRP + Purchase (afi10) ‚Üí Margin + %
// -------------------------
function calculateMargin() {
    let mrp = parseFloat(document.getElementById("afi11").value);
    let purchase = parseFloat(document.getElementById("afi10").value); // FIXED as requested

    if (!isNaN(mrp) && !isNaN(purchase) && mrp > 0) {
        let marginAmt = mrp - purchase;
        let marginPercent = (marginAmt / mrp) * 100;

        document.getElementById("result").innerHTML =
            "Margin: ‚Çπ" + marginAmt.toFixed(2) +
            " | Percent Less: " + marginPercent.toFixed(2) + "%";
    } else {
        document.getElementById("result").innerHTML = "";
    }
}

// realtime calculate
document.getElementById("afi11").addEventListener("input", calculateMargin);
document.getElementById("afi10").addEventListener("input", calculateMargin);


// -------------------------
// 2) afi06 + afi08 ‚Üí afi10
// -------------------------
function calculateafi10() {
  let afi06 = parseFloat(document.getElementById("afi06").value);
  let net = parseFloat(document.getElementById("afi08").value);

  if (!isNaN(afi06) && afi06 > 0 && !isNaN(net)) {
    document.getElementById("afi10").value = (net / afi06).toFixed(2);

    // update margin instantly after value comes
    calculateMargin();
  }
}

document.getElementById("afi06").addEventListener("input", calculateafi10);
document.getElementById("afi08").addEventListener("input", calculateafi10);

</script>


<!-- ================= CSS ================= -->
<style>


.popupAFICM-overlay {
  position: fixed;
  inset: 0;
  background: rgba(253, 249, 249, 0.45);
  display: none;

  justify-content: center;
  z-index: 999;
top: 150px;
height: 50vh;
}

.popupAFICM-content {
  width: 80%;
  max-width: 1100px;
  background: white;
  padding: 20px 30px;
  border-radius: 14px;
  box-shadow: 0 8px 25px rgba(91, 0, 0, 0.3);
  animation: slideDown 0.3s ease;
  position: relative;
}

@keyframes slideDown {
  from { transform: translateY(-40px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  color: #035b67;
  font-size: 25px;
}

.close-btn:hover {
  color: #db0a03;
}
.AFICM-form {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 18px;
}

.row {
  display: grid;
  grid-template-columns: auto 1fr auto 1fr auto 1fr auto 1fr;
  gap: 16px;
  align-items: center;
  
}

.row input,
.row select {
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

.submit-btn {
  background: #035b67;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  width: 160px;
  font-size: 15px;
  margin: auto;
}
.submit-btn:hover {
  background: #048093;
}
</style>
<!-- ================= JS ================= -->
<script>
document.getElementById("openAFICMBtn").onclick = () => {
  document.getElementById("AFICMPopup").style.display = "flex";
};

document.getElementById("closeAFICMBtn").onclick = () => {
  document.getElementById("AFICMPopup").style.display = "none";
};

/* ‚ùå Popup outside click function ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ
window.onclick = function(e){
  if(e.target.id === "AFICMPopup"){
    document.getElementById("AFICMPopup").style.display = "none";
  }
};
*/



</script>


<!-- ----------------------------------------------------- POPUP OPEN AND CLOSE WITH FORM CODE STOP HARE ------------------------------------------------------- -->




<!-- ================= FORM DROPDOWN SCRIPT START HARE ================= -->

<script>

const apiAFICMKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetAFICMId = "1g_hAVEIFZRnRNFFQWF275Y_AXKBTw0UIP0xiH4_C2V0";
const rangeAFICM = "FORM!A:M";

/* ============================================================
   STORE DATA
============================================================ */
let storeAFIData = [];

document.addEventListener("DOMContentLoaded", () => {

    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetAFICMId}/values/${rangeAFICM}?key=${apiAFICMKey}`)
        .then(res => res.json())
        .then(data => {
            if (!data.values || data.values.length < 2) return;

            storeAFIData = data.values.slice(1);

            const filtered = storeAFIData.filter(r => r[1] === "DNAME");

            fillUniqueSortedOptions(filtered);
        })
        .catch(err => console.error("Fetch Error:", err));
});

/* ============================================================
   UNIQUE + SORTED + MANUAL ENTRY OPTION
============================================================ */
function fillUniqueSortedOptions(rows) {

    const selects = [
        { element: document.getElementById("afi03"), index: 12 }, // Column M
        { element: document.getElementById("afi04"), index: 2 },  // Column C
        { element: document.getElementById("afi05"), index: 3 }   // Column D
    ];

    selects.forEach(sel => {
        const colSet = new Set();

        rows.forEach(r => {
            if (r[sel.index]) colSet.add(r[sel.index].trim());
        });

        const sortedValues = Array.from(colSet).sort();

        // Reset select
        sel.element.innerHTML = `
            <option value="">Select</option>
            <option value="__manual__" style="color: blue;">‚ûï Create New Entry</option>
        `;

        // Add sorted values
        sortedValues.forEach(v => {
            sel.element.innerHTML += `<option value="${v}">${v}</option>`;
        });

        // Attach manual entry handler
        sel.element.addEventListener("change", function () {
            if (this.value === "__manual__") {
                let val = prompt("Enter new Details:");

                if (val && val.trim() !== "") {
                    val = val.trim();

                    // Add new option dynamically
                    const newOption = document.createElement("option");
                    newOption.value = val;
                    newOption.textContent = val;

                    this.appendChild(newOption);
                    this.value = val; // auto select new value
                } else {
                    this.value = ""; // reset to default
                }
            }
        });
    });
}



/* ============================================================
   REFRESH FUNCTION (CALLS API AGAIN + RELOADS DROPDOWNS)
============================================================ */
function refreshAFIData() {

    // Optionally loading indicator
    console.log("Refreshing Google Sheet data...");

    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetAFICMId}/values/${rangeAFICM}?key=${apiAFICMKey}`)
        .then(res => res.json())
        .then(data => {
            if (!data.values || data.values.length < 2) {
                alert("No data found!");
                return;
            }

            storeAFIData = data.values.slice(1);

            const filtered = storeAFIData.filter(r => r[1] === "DNAME");

            // Refill all dropdowns
            fillUniqueSortedOptions(filtered);

          //  alert("‚úî Data & Dropdown Refreshed Successfully");
        })
        .catch(err => {
            console.error("Refresh Error:", err);
            alert("Error refreshing data!");
        });
}

</script>


<!-- ================= FORM DROPDOWN SCRIPT STOP HARE ================= -->



<!-- ================ FORM SUBMITEED SCRIPT STOP HARE ===============================-->




<script>
// ================= CONFIG =================
const scriptAFICMURL = 'https://script.google.com/macros/s/AKfycbzaRa0UsJlWtTRyWxOttKhhvNmMYBN8KjiOonHece4PEvQ0Mo1hvJ--YupQP-0bh6Nx/exec';

// ================= SR NO POPUP LOGIC =================
function openSrNoPopup() {
    const srNo = prompt("Enter Serial No. to Fetch Data:");
    if (!srNo || srNo.trim() === "") {
        alert("Serial No. Required!");
        return null;
    }
    return srNo.trim();
}

// ================= MODIFY BUTTON CLICK =================
document.getElementById("openMODIFYBtn").onclick = async () => {
    const sr = openSrNoPopup();
    if (!sr) return;

    // show wait message
    const waitMsg = document.getElementById("waitAFIMessage");
    waitMsg.innerText = "Please wait fetching data...";
    waitMsg.style.display = "block";

    const url = scriptAFICMURL + "?sNo=" + sr;
    try {
        let res = await fetch(url);
        let data = await res.json();

        if (data.result === "error" || !data.SNo) {
            alert("SR NO NOT FOUND!");
            waitMsg.style.display = "none";
            return;
        }

        // fill form
        fillAFICMForm(data);

        // show fetched SR NO in span
        const srSpan = document.getElementById("fetchedSRNo");
        if(srSpan) srSpan.innerText = data.SNo;

        // set hidden sNo for modify
        document.getElementById("sNo").value = data.SNo;

        // hide wait message
        waitMsg.style.display = "none";

        // open form popup
        document.getElementById("AFICMPopup").style.display = "flex";

    } catch (err) {
        console.log(err);
        alert("ERROR FETCHING DATA");
        waitMsg.style.display = "none";
    }
};

// ================= AUTO-FILL FORM FUNCTION =================
function fillAFICMForm(d) {
    const map = {
        "sNo": "SNo",
        "TimestampAFICM": "Timestamp",
        "afi01": "Type",
        "afi02": "esmK",
        "afi03": "esmM",
        "afi04": "esmC",
        "afi05": "esmD",
        "afi06": "esmE",
        "afi07": "esmH",
        "afi08": "esmG",
        "afi10": "esmF",
        "afi11": "esmI",
        "afi12": "esmL",
        "afi13": "esmJ",
        "afi14": "esmN"
    };
    Object.keys(map).forEach(id => {
        const col = map[id];
        if (document.getElementById(id)) {
            document.getElementById(id).value = d[col] ?? "";
        }
    });
}

// ================= CLOSE FORM POPUP =================
document.getElementById("closeAFICMBtn").onclick = () => {
    document.getElementById("AFICMPopup").style.display = "none";
};



// ================= FORM SUBMIT =================
document.addEventListener("submit", async function(e) {
    const form = e.target;
    if (form.id !== "mainAFICMForm") return;
    e.preventDefault();

    const submitBtn = document.getElementById("submitAFICMButton");
    const waitMsg = document.getElementById("waitAFIMessage");

    submitBtn.disabled = true;
    submitBtn.value = "Please wait...";
    waitMsg.innerText = "Submitting...";
    waitMsg.style.display = "block";

    // Timestamp add
    const now = new Date();
    document.getElementById('TimestampAFICM').value =
        `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    try {
        const formData = new FormData(form);
        const response = await fetch(scriptAFICMURL, { method: 'POST', body: formData });
        const result = await response.json();

        if (result.result === 'success') {
            alert('‚úÖ Success! Form submitted.');

            // reset form
            form.reset();

            // clear SR NO display
            const srSpan = document.getElementById("fetchedSRNo");
            if(srSpan) srSpan.innerText = "";

            // reset hidden sNo for new entries
            document.getElementById("sNo").value = "";

            // reload data functions
            if (typeof refreshAFIData === "function") refreshAFIData();
            if (typeof loadAFIData === "function") loadAFIData();
            if (typeof loadPSWData === "function") loadPSWData();

        } else {
            alert(`‚ùå Error: ${result.error || 'Unknown error occurred.'}`);
        }
    } catch (err) {
        alert(`‚ùå Error submitting form: ${err.message}`);
    } finally {
        submitBtn.disabled = false;
        submitBtn.value = "Submit";
        setTimeout(() => (waitMsg.style.display = 'none'), 2000);
    }
});
</script>


<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ------------------------------ !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->












<!-- ==================================== buttan shorcut by function key script start hare ======================== -->

<script>
document.addEventListener("keydown", function (e) {

    /* --------------------  F4 FUNCTION  -------------------- */
    if (e.key === "F4") {
        e.preventDefault();

        // 1. openAFICMBtn button activate
        const openBtn = document.getElementById("openAFICMBtn");
        if (openBtn) openBtn.click();

        // 2. afi01 input focus + select
        const afiInput = document.getElementById("afi01");
        if (afiInput) {
            afiInput.focus();
            afiInput.select();   // ‡§™‡•Å‡§∞‡§æ‡§®‡§æ data select
        }
    }

    /* --------------------  F3 FUNCTION  -------------------- */
    if (e.key === "F3") {
        e.preventDefault();

        // 1. closeAFICMBtn button activate
        const closeBtn = document.getElementById("closeAFICMBtn");
        if (closeBtn) closeBtn.click();

        // 2. searchBtn button activate
        const searchBtn = document.getElementById("searchBtn");
        if (searchBtn) searchBtn.click();

        // 3. afiSearchInput focus + clear (delete old value)
        const searchInput = document.getElementById("afiSearchInput");
        if (searchInput) {
            searchInput.focus();
            searchInput.value = "";   // ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä value delete
        }
    }

    /* --------------------  F6 FUNCTION  -------------------- */
    if (e.key === "F6") {
        e.preventDefault();

        // 1. closeAFICMBtn button activate
        const closeBtn = document.getElementById("closeAFICMBtn");
        if (closeBtn) closeBtn.click();

        // 2. searchDRUG button activate
        const searchDRUG = document.getElementById("searchDRUG");
        if (searchDRUG) searchDRUG.click();

        // 3. afiSearchInput focus + clear (delete old value)
        const searchInput = document.getElementById("afiSearchInput");
        if (searchInput) {
            searchInput.focus();
            searchInput.value = "";   // ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä value delete
        }
    }

    /* --------------------  F6 FUNCTION  -------------------- */
/* --------------------  F6 FUNCTION  -------------------- */
if (e.altKey && (e.key === "m" || e.key === "M")) {
    e.preventDefault();

    // direct function call
    if (typeof openMRGNPrompt === "function") {
        openMRGNPrompt();

        // ---- After function run ‚Üí focus & clear pRate ----
        setTimeout(() => {
            const pRate = document.getElementById("pRate");
            if (pRate) {
                pRate.focus();      // Focus set
                pRate.value = "";   // Old value delete
            }
        }, 50); // ‡§•‡•ã‡•ú‡§æ delay ‡§§‡§æ‡§ï‡§ø popup load ‡§π‡•ã ‡§ú‡§æ‡§è
    }
}


});

</script>
<!-- ==================================== buttan shorcut by function key script stop hare ======================== -->













<!-- ==================================== Margin calculator script start hare ======================== -->
<!DOCTYPE html>
<html>
<head>
    <title>Draggable Prompt Margin Calculator</title>

    <style>
        #promptMRGNBox {
            display: none;
            position: fixed;
            left: 50%;
            top: 60%;
            transform: translate(-50%, -50%);
            background: #fff;
            width: 400px;
            padding: 0;
            border-radius: 8px;
            box-shadow: 0 0 12px rgba(0,0,0,0.4);
            font-family: Arial;
            cursor: move; /* drag cursor */
        }

        /* Header bar for dragging */
        #headerMRGNBar {
            background: #016e60;
            color: white;
            padding: 10px;
            border-radius: 8px 8px 0 0;
            cursor: grab;
        }
#contentMRGN {
    padding: 18px;
    display: flex;
    flex-direction: column;
}

.inputRow {
    display: flex;
    gap: 10px;        /* inputs ke beech space */
    margin-bottom: 10px;
}

.inputRow div {
    flex: 1;
}

.inputRow input {
    width: 100%;
    padding: 5px;
}

        #resultMRGN {
            margin-top: 10px;
            font-weight: bold;
            color: blue;
        }

        #closeMRGNBtn {
            margin-top: 10px;
            padding: 6px 14px;
        }
    </style>
</head>
<body>


<!-- <button onclick="openMRGNPrompt()">Open Prompt</button> -->

<div id="promptMRGNBox">
    
    <div id="headerMRGNBar">Margin Calculator</div>

  <div id="contentMRGN">

    <div class="inputRow">
        <div>
            Purchase Rate:<br>
            <input type="number" id="pRate" oninput="calc()" placeholder="Purchase">
        </div>

        <div>
            MRP:<br>
            <input type="number" id="mRate" oninput="calc()" placeholder="MRP">
        </div>
    </div>

    <div id="resultMRGN"></div>

    <button id="closeMRGNBtn" onclick="closeMRGNPrompt()">Close</button>

</div>


</div>

<script>
/* ----------------- OPEN / CLOSE ----------------- */

function openMRGNPrompt() {
    document.getElementById("promptMRGNBox").style.display = "block";
}

function closeMRGNPrompt() {
    document.getElementById("promptMRGNBox").style.display = "none";
}

/* ----------------- CALCULATION ----------------- */

function calc() {
    let purchase = parseFloat(document.getElementById("pRate").value);
    let mrp = parseFloat(document.getElementById("mRate").value);

    if (isNaN(purchase) || isNaN(mrp) || mrp === 0) {
        document.getElementById("resultMRGN").innerHTML = "";
        return;
    }

    let margin = mrp - purchase;
    let percent = (margin / mrp) * 100;

    document.getElementById("resultMRGN").innerHTML =
        `Margin: ‚Çπ${margin.toFixed(2)} | Percent Less: ${percent.toFixed(2)}%`;
}

/* ----------------- DRAGGABLE POPUP ----------------- */

dragElement(document.getElementById("promptMRGNBox"));

function dragElement(el) {
    const header = document.getElementById("headerMRGNBar");
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

    header.onmousedown = dragMouseDown;

    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();

        pos3 = e.clientX;
        pos4 = e.clientY;

        document.onmouseup = closeDrag;
        document.onmousemove = drag;
    }

    function drag(e) {
        e = e || window.event;
        e.preventDefault();

        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;

        pos3 = e.clientX;
        pos4 = e.clientY;

        el.style.top = (el.offsetTop - pos2) + "px";
        el.style.left = (el.offsetLeft - pos1) + "px";
    }

    function closeDrag() {
        document.onmouseup = null;
        document.onmousemove = null;
    }
}
</script>

</body>
</html>

<!-- ==================================== Margin calculator script start hare ======================== -->

